<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Kalend√°≈ôn√≠ kalkul√°tor - Roz≈°√≠≈ôen√Ω</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #8B7355 0%, #6B5B47 25%, #4A4A3A 50%, #5D4E37 75%, #8B7355 100%);
            --bg-container: linear-gradient(145deg, rgba(139, 118, 76, 0.8) 0%, rgba(101, 67, 33, 0.9) 100%);
            --border-main: rgba(205, 186, 150, 0.4);
            --text-primary: #F5E6D3;
            --text-accent: #CDBA96;
            --control-bg: linear-gradient(145deg, rgba(15, 15, 15, 0.9) 0%, rgba(35, 35, 35, 0.8) 100%);
            --control-border: rgba(60, 60, 60, 0.8);
            --button-bg: linear-gradient(145deg, #1a1a1a 0%, #2d2d2d 30%, #0f0f0f 70%, #1a1a1a 100%);
        }
        .theme-blue {
            --bg-primary: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 25%, #1e40af 50%, #2563eb 75%, #1e3a8a 100%);
            --bg-container: linear-gradient(145deg, rgba(30, 58, 138, 0.8) 0%, rgba(37, 99, 235, 0.9) 100%);
            --border-main: rgba(147, 197, 253, 0.4);
            --text-primary: #dbeafe;
            --text-accent: #93c5fd;
        }
        .theme-green {
            --bg-primary: linear-gradient(135deg, #14532d 0%, #16a34a 25%, #15803d 50%, #22c55e 75%, #14532d 100%);
            --bg-container: linear-gradient(145deg, rgba(20, 83, 45, 0.8) 0%, rgba(21, 128, 61, 0.9) 100%);
            --border-main: rgba(134, 239, 172, 0.4);
            --text-primary: #dcfce7;
            --text-accent: #86efac;
        }
        .theme-purple {
            --bg-primary: linear-gradient(135deg, #581c87 0%, #a855f7 25%, #7c3aed 50%, #8b5cf6 75%, #581c87 100%);
            --bg-container: linear-gradient(145deg, rgba(88, 28, 135, 0.8) 0%, rgba(124, 58, 237, 0.9) 100%);
            --border-main: rgba(196, 181, 253, 0.4);
            --text-primary: #f3e8ff;
            --text-accent: #c4b5fd;
        }
        .theme-red {
            --bg-primary: linear-gradient(135deg, #7f1d1d 0%, #dc2626 25%, #b91c1c 50%, #ef4444 75%, #7f1d1d 100%);
            --bg-container: linear-gradient(145deg, rgba(127, 29, 29, 0.8) 0%, rgba(185, 28, 28, 0.9) 100%);
            --border-main: rgba(252, 165, 165, 0.4);
            --text-primary: #fef2f2;
            --text-accent: #fca5a5;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: Arial, sans-serif; 
            background: var(--bg-primary); 
            min-height: 100vh; 
            padding: 10px; 
            color: var(--text-primary); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
            overflow-x: hidden; 
        }
        
        .container { 
            max-width: 100%; 
            width: 100%; 
            margin: 0 auto; 
            background: var(--bg-container); 
            border-radius: 20px; 
            padding: 20px; 
            border: 2px solid var(--border-main); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); 
            position: relative; 
        }
        
        .menu-container { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            z-index: 100; 
        }
        
        .menu-button { 
            width: 44px; 
            height: 44px; 
            border-radius: 50%; 
            background: var(--button-bg); 
            border: 2px solid var(--control-border); 
            color: var(--text-primary); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
            font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9); 
            -webkit-user-select: none; 
            user-select: none; 
            z-index: 101; 
        }
        
        .menu-button:active { 
            transform: scale(0.95); 
            background: rgba(50, 50, 50, 0.8); 
        }
        
        .menu-dropdown { 
            position: absolute; 
            top: 50px; 
            right: 0; 
            min-width: 320px; 
            background: var(--control-bg); 
            border: 2px solid var(--control-border); 
            border-radius: 12px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7); 
            opacity: 0; 
            visibility: hidden; 
            transform: translateY(-10px); 
            transition: all 0.3s ease; 
            max-height: 70vh; 
            overflow-y: auto; 
            display: none; 
        }
        
        .menu-dropdown.show { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
            display: block; 
        }
        
        .menu-section { 
            padding: 8px 0; 
            border-bottom: 1px solid rgba(80, 80, 80, 0.3); 
        }
        
        .menu-section:last-child { 
            border-bottom: none; 
        }
        
        .menu-section-title { 
            padding: 8px 16px; 
            color: var(--text-accent); 
            font-size: 12px; 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        
        .menu-item, .theme-item { 
            padding: 12px 16px; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            font-size: 15px; 
            font-weight: 500; 
            cursor: pointer; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 44px; 
        }
        
        .menu-item:active, .theme-item:active { 
            background: rgba(60, 60, 60, 0.6); 
            color: var(--text-accent); 
        }
        
        .menu-item.has-submenu { 
            justify-content: space-between; 
        }
        
        .menu-item.has-submenu::after { 
            content: "‚ñ∂"; 
            font-size: 12px; 
            color: var(--text-accent); 
        }
        
        .submenu { 
            display: none; 
            background: rgba(25, 25, 25, 0.95); 
            border-left: 3px solid var(--border-main); 
            margin-top: 8px; 
            border-radius: 8px; 
        }
        
        .submenu.show { 
            display: block; 
        }
        
        .submenu .menu-item { 
            padding-left: 24px; 
            font-size: 14px; 
        }
        
        .theme-item { 
            gap: 10px; 
        }
        
        .theme-preview { 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            border: 2px solid rgba(255, 255, 255, 0.3); 
            flex-shrink: 0; 
        }
        
        .theme-bronze .theme-preview { 
            background: linear-gradient(45deg, #8B7355, #CDBA96); 
        }
        
        .theme-blue .theme-preview { 
            background: linear-gradient(45deg, #3b82f6, #93c5fd); 
        }
        
        .theme-green .theme-preview { 
            background: linear-gradient(45deg, #16a34a, #86efac); 
        }
        
        .theme-purple .theme-preview { 
            background: linear-gradient(45deg, #a855f7, #c4b5fd); 
        }
        
        .theme-red .theme-preview { 
            background: linear-gradient(45deg, #dc2626, #fca5a5); 
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 25px; 
            margin-top: 15px; 
            padding-right: 60px; 
        }
        
        .header h1 { 
            font-size: 22px; 
            font-weight: 700; 
            margin-bottom: 8px; 
            color: var(--text-primary); 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); 
            line-height: 1.2; 
        }
        
        .header p { 
            color: var(--text-primary); 
            font-size: 14px; 
            font-weight: 400; 
            font-style: italic; 
            opacity: 0.9; 
        }
        
        .display { 
            background: var(--control-bg); 
            border-radius: 18px; 
            padding: 20px; 
            margin-bottom: 20px; 
            min-height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            border: 2px solid var(--control-border); 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
        }
        
        .display.result { 
            background: linear-gradient(145deg, rgba(20, 60, 20, 0.9) 0%, rgba(30, 80, 30, 0.8) 100%); 
            border-color: rgba(100, 150, 100, 0.6); 
        }
        
        .display.error { 
            background: linear-gradient(145deg, rgba(60, 20, 20, 0.9) 0%, rgba(80, 30, 30, 0.8) 100%); 
            border-color: rgba(150, 100, 100, 0.6); 
        }
        
        .display-text { 
            font-size: 16px; 
            font-weight: 500; 
            line-height: 1.4; 
            word-wrap: break-word; 
        }
        
        .calculator-view { 
            display: none; 
        }
        
        .calculator-view.active { 
            display: block; 
        }
        
        .input-section { 
            margin-bottom: 20px; 
        }
        
        .input-label { 
            display: block; 
            margin-bottom: 12px; 
            font-weight: 600; 
            color: var(--text-primary); 
            font-size: 15px; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
        }
        
        .date-input-container { 
            margin-bottom: 18px; 
        }
        
        .date-input, .number-input, .location-input { 
            width: 100%; 
            padding: 18px; 
            border: 2px solid var(--control-border); 
            border-radius: 12px; 
            background: var(--control-bg); 
            color: var(--text-primary); 
            font-size: 18px; 
            text-align: center; 
            outline: none; 
            font-weight: 500; 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); 
            -webkit-appearance: none; 
            min-height: 56px; 
        }
        
        .date-input:focus, .number-input:focus, .location-input:focus { 
            border-color: var(--border-main); 
        }
        
        .date-input::placeholder, .number-input::placeholder, .location-input::placeholder { 
            color: rgba(180, 180, 180, 0.7); 
            font-weight: 400; 
        }
        
        .format-hint { 
            font-size: 13px; 
            color: var(--text-accent); 
            text-align: center; 
            margin-top: 8px; 
            font-style: italic; 
            line-height: 1.3; 
        }
        
        .calculate-btn { 
            width: 100%; 
            padding: 18px; 
            background: var(--button-bg); 
            color: var(--text-primary); 
            border: 2px solid var(--control-border); 
            border-radius: 15px; 
            font-size: 17px; 
            font-weight: 700; 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4); 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9); 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 56px; 
            -webkit-appearance: none; 
            margin-bottom: 15px; 
        }
        
        .calculate-btn:active { 
            transform: scale(0.98); 
        }
        
        .examples { 
            margin-top: 20px; 
            background: var(--control-bg); 
            border-radius: 15px; 
            padding: 18px; 
            border: 1px solid var(--control-border); 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
        }
        
        .examples h3 { 
            font-size: 16px; 
            margin-bottom: 12px; 
            color: var(--text-accent); 
            font-weight: 600; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
        }
        
        .examples ul { 
            list-style: none; 
            font-size: 14px; 
            line-height: 1.4; 
        }
        
        .examples li { 
            margin-bottom: 8px; 
            color: var(--text-primary); 
            font-weight: 400; 
            opacity: 0.9; 
            cursor: pointer; 
            padding: 8px 4px; 
            border-radius: 6px; 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 44px; 
            display: flex; 
            align-items: center; 
        }
        
        .examples li:active { 
            color: var(--text-accent); 
            background: rgba(255, 255, 255, 0.1); 
        }
        
        .examples li::before { 
            content: "‚Üí "; 
            color: var(--text-accent); 
            font-weight: 700; 
            margin-right: 8px; 
        }
        
        .loading { 
            display: inline-block; 
            width: 18px; 
            height: 18px; 
            border: 2px solid rgba(245, 230, 211, 0.3); 
            border-radius: 50%; 
            border-top-color: var(--text-primary); 
            animation: spin 1s linear infinite; 
            margin-right: 8px; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
                
        .input-row { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 18px; 
        }
        
        .input-col { 
            flex: 1; 
        }
        
        .back-button {
            width: 100%;
            padding: 12px;
            background: var(--control-bg);
            color: var(--text-accent);
            border: 2px solid var(--control-border);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            margin-bottom: 20px;
            -webkit-user-select: none; 
            user-select: none;
        }
        
        .back-button:active { 
            transform: scale(0.98); 
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            .container { padding: 15px; border-radius: 15px; }
            .header h1 { font-size: 20px; }
            .date-input, .number-input, .location-input { font-size: 16px; padding: 16px; }
            .calculate-btn { font-size: 16px; padding: 16px; }
            .menu-dropdown { min-width: 320px; right: -10px; max-width: calc(100vw - 40px); }
            .input-row { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="menu-container">
            <div class="menu-button" id="menuButton">‚ãÆ</div>
            <div class="menu-dropdown" id="menuDropdown">
                <div class="menu-section">
                    <div class="menu-item" id="dayOfWeekMenu">üìÖ Den v t√Ωdnu</div>
                    <div class="menu-item" id="versionButton">Kalend√°≈ôn√≠ kalkul√°tor v4.0</div>
                    <div class="menu-item has-submenu" id="calculatorsMenu">üßÆ Dal≈°√≠ v√Ωpoƒçty</div>
                    <div class="submenu" id="calculatorsSubmenu">
                        <div class="menu-item" data-calculator="year-finder">üîç Hledaƒç rok≈Ø</div>
                        <div class="menu-item" data-calculator="calendar-converter">üîÑ P≈ôevod kalend√°≈ô≈Ø</div>
                        <div class="menu-item" data-calculator="easter">ü•ö Velikonoce</div>
                        <div class="menu-item" data-calculator="moon-phase">üåô F√°ze Mƒõs√≠ce</div>
                        <div class="menu-item" data-calculator="date-math">‚ûï Kalend√°≈ôn√≠ aritmetika</div>
                    </div>
                    <div class="menu-item has-submenu" id="astronomyMenu">üåü Astronomick√© v√Ωpoƒçty</div>
                    <div class="submenu" id="astronomySubmenu">
                        <div class="menu-item" data-calculator="sun-events">‚òÄÔ∏è Sluneƒçn√≠ ud√°losti</div>
                        <div class="menu-item" data-calculator="planet-positions">ü™ê Pozice planet</div>
                        <div class="menu-item" data-calculator="eclipses">üåë Zatmƒõn√≠</div>
                        <div class="menu-item" data-calculator="sidereal-time">‚è∞ Hvƒõzdn√Ω ƒças</div>
                    </div>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">Barevn√° t√©mata</div>
                    <div class="theme-item theme-bronze" data-theme="">
                        <div class="theme-preview"></div>
                        Bronzov√© (v√Ωchoz√≠)
                    </div>
                    <div class="theme-item theme-blue" data-theme="theme-blue">
                        <div class="theme-preview"></div>
                        Modr√©
                    </div>
                    <div class="theme-item theme-green" data-theme="theme-green">
                        <div class="theme-preview"></div>
                        Zelen√©
                    </div>
                    <div class="theme-item theme-purple" data-theme="theme-purple">
                        <div class="theme-preview"></div>
                        Fialov√©
                    </div>
                    <div class="theme-item theme-red" data-theme="theme-red">
                        <div class="theme-preview"></div>
                        ƒåerven√©
                    </div>
                </div>
                <div class="menu-section">
                    <div class="menu-item" data-link="https://claude.ai">Created by Claude AI</div>
                    <div class="menu-item" data-link="https://kalendar.beda.cz/kalendar-rozcestnik">V√≠ce o kalend√°≈ô√≠ch</div>
                </div>
            </div>
        </div>

        <!-- Day of Week Calculator -->
        <div id="dayOfWeekCalculator" class="calculator-view active">
            <div class="header">
                <h1>üìÖ Den v t√Ωdnu</h1>
                <p>Zjistƒõte den v t√Ωdnu pro jak√©koliv datum v historii</p>
            </div>
            <div id="display" class="display">
                <div class="display-text">M√≠sto pro v√Ωsledek</div>
            </div>
            <div class="input-section">
                <label class="input-label" for="dateInput">Zadejte datum:</label>
                <div class="date-input-container">
                    <input type="text" id="dateInput" class="date-input" placeholder="1.1.1 nebo 15.3.44 nebo 01031989" inputmode="numeric" maxlength="15">
                    <div class="format-hint">Form√°ty: 1.1.1 ‚Ä¢ 15.3.44 ‚Ä¢ 1989 ‚Ä¢ 1/3/1989 ‚Ä¢ 01031989</div>
                </div>
            </div>
            <button id="calculateBtn" class="calculate-btn">Vypoƒç√≠tat</button>

            <div class="examples">
                <h3>üí° Vyzkou≈°ejte:</h3>
                <ul>
                    <li data-date="1.1.1">1.1.1 - zaƒç√°tek na≈°eho letopoƒçtu</li>
                    <li data-date="15.3.044">15.3.44 - zavra≈ædƒõn√≠ Julia Caesara</li>
                    <li data-date="4.10.1582">4.10.1582 - posledn√≠ den juli√°nsk√©ho kalend√°≈ôe</li>
                    <li data-date="15.10.1582">15.10.1582 - prvn√≠ den gregori√°nsk√©ho kalend√°≈ôe</li>
                    <li data-date="8.10.1582">8.10.1582 - neexistuj√≠c√≠ datum!</li>
                    <li data-date="1.1.2000">1.1.2000 - zaƒç√°tek nov√©ho tis√≠cilet√≠</li>
                </ul>
            </div>
        </div>

        <!-- Year Finder Calculator -->
        <div id="yearFinderCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>üîç Hledaƒç rok≈Ø</h1>
                <p>Najdƒõte roky pro urƒçitou kombinaci dne, mƒõs√≠ce a dne v t√Ωdnu</p>
            </div>
            <div id="yearFinderDisplay" class="display">
                <div class="display-text">Nastavte parametry a zobrazte vyhovuj√≠c√≠ roky</div>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="input-label">Den v mƒõs√≠ci:</label>
                    <input type="number" id="yearFinderDay" class="number-input" placeholder="1-31" min="1" max="31">
                </div>
                <div class="input-col">
                    <label class="input-label">Mƒõs√≠c:</label>
                    <input type="number" id="yearFinderMonth" class="number-input" placeholder="1-12" min="1" max="12">
                </div>
            </div>
            <div class="input-section">
                <label class="input-label">Den v t√Ωdnu:</label>
                <select id="yearFinderDayOfWeek" class="date-input">
                    <option value="">Vyberte den</option>
                    <option value="1">Pondƒõl√≠</option>
                    <option value="2">√öter√Ω</option>
                    <option value="3">St≈ôeda</option>
                    <option value="4">ƒåtvrtek</option>
                    <option value="5">P√°tek</option>
                    <option value="6">Sobota</option>
                    <option value="0">Nedƒõle</option>
                </select>
            </div>
            <button id="yearFinderBtn" class="calculate-btn">Naj√≠t roky</button>
        </div>

        <!-- Calendar Converter -->
        <div id="calendarConverterCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>üîÑ P≈ôevod kalend√°≈ô≈Ø</h1>
                <p>P≈ôevod mezi gregori√°nsk√Ωm a juli√°nsk√Ωm kalend√°≈ôem</p>
            </div>
            <div id="converterDisplay" class="display">
                <div class="display-text">Zadejte datum pro p≈ôevod mezi kalend√°≈ôi</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="converterDate" class="date-input" placeholder="15.10.1582" inputmode="numeric">
            </div>
            <div class="input-section">
                <label class="input-label">Typ kalend√°≈ôe:</label>
                <select id="converterType" class="date-input">
                    <option value="gregorian">Gregori√°nsk√Ω ‚Üí Juli√°nsk√Ω</option>
                    <option value="julian">Juli√°nsk√Ω ‚Üí Gregori√°nsk√Ω</option>
                </select>
            </div>
            <button id="converterBtn" class="calculate-btn">P≈ôev√©st</button>
        </div>

        <!-- Easter Calculator -->
        <div id="easterCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>ü•ö Velikonoce</h1>
                <p>V√Ωpoƒçet data Velikonoƒçn√≠ nedƒõle a souvisej√≠c√≠ch sv√°tk≈Ø</p>
            </div>
            <div id="easterDisplay" class="display">
                <div class="display-text">Zadejte rok pro v√Ωpoƒçet velikonoƒçn√≠ch sv√°tk≈Ø</div>
            </div>
            <div class="input-section">
                <label class="input-label">Rok:</label>
                <input type="number" id="easterYear" class="number-input" placeholder="2025" min="1" max="9999">
            </div>
            <button id="easterBtn" class="calculate-btn">Vypoƒç√≠tat Velikonoce</button>
        </div>

        <!-- Moon Phase Calculator -->
        <div id="moonPhaseCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>üåô F√°ze Mƒõs√≠ce</h1>
                <p>Zjistƒõte f√°zi Mƒõs√≠ce pro dan√© datum</p>
            </div>
            <div id="moonDisplay" class="display">
                <div class="display-text">Zadejte datum pro zji≈°tƒõn√≠ f√°ze Mƒõs√≠ce</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="moonDate" class="date-input" placeholder="6.7.2025" inputmode="numeric">
            </div>
            <button id="moonBtn" class="calculate-btn">Vypoƒç√≠tat f√°zi</button>
        </div>

        <!-- Date Math Calculator -->
        <div id="dateMathCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>‚ûï Kalend√°≈ôn√≠ aritmetika</h1>
                <p>P≈ôiƒç√≠t√°n√≠/odƒç√≠t√°n√≠ dn≈Ø a v√Ωpoƒçet rozd√≠l≈Ø mezi daty</p>
            </div>
            <div id="dateMathDisplay" class="display">
                <div class="display-text">Vyberte typ v√Ωpoƒçtu a zadejte data</div>
            </div>
            <div class="input-section">
                <label class="input-label">Typ v√Ωpoƒçtu:</label>
                <select id="mathType" class="date-input">
                    <option value="add">P≈ôiƒç√≠st dny k datu</option>
                    <option value="diff">Rozd√≠l mezi daty</option>
                </select>
            </div>
            <div id="addOperation" class="input-section">
                <div class="input-row">
                    <div class="input-col">
                        <label class="input-label">Datum:</label>
                        <input type="text" id="mathDate1" class="date-input" placeholder="1.1.2025" inputmode="numeric">
                    </div>
                    <div class="input-col">
                        <label class="input-label">Dny (+/-):</label>
                        <input type="number" id="mathDays" class="number-input" placeholder="100">
                    </div>
                </div>
            </div>
            <div id="diffOperation" class="input-section" style="display: none;">
                <div class="input-row">
                    <div class="input-col">
                        <label class="input-label">Od data:</label>
                        <input type="text" id="mathDate2" class="date-input" placeholder="1.1.2025" inputmode="numeric">
                    </div>
                    <div class="input-col">
                        <label class="input-label">Do data:</label>
                        <input type="text" id="mathDate3" class="date-input" placeholder="31.12.2025" inputmode="numeric">
                    </div>
                </div>
            </div>
            <button id="dateMathBtn" class="calculate-btn">Vypoƒç√≠tat</button>
        </div>

        <!-- NEW: Sun Events Calculator -->
        <div id="sunEventsCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>‚òÄÔ∏è Sluneƒçn√≠ ud√°losti</h1>
                <p>V√Ωchod, z√°pad slunce a d√©lka dne pro zadan√© m√≠sto</p>
            </div>
            <div id="sunEventsDisplay" class="display">
                <div class="display-text">Zadejte datum a sou≈ôadnice pro v√Ωpoƒçet sluneƒçn√≠ch ud√°lost√≠</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="sunEventsDate" class="date-input" placeholder="21.6.2025" inputmode="numeric">
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="input-label">Zemƒõpisn√° ≈°√≠≈ôka:</label>
                    <input type="number" id="latitude" class="location-input" placeholder="50.0755" step="0.0001" min="-90" max="90">
                </div>
                <div class="input-col">
                    <label class="input-label">Zemƒõpisn√° d√©lka:</label>
                    <input type="number" id="longitude" class="location-input" placeholder="14.4378" step="0.0001" min="-180" max="180">
                </div>
            </div>
            <div class="format-hint">Praha: 50.0755, 14.4378 ‚Ä¢ Brno: 49.1951, 16.6068</div>
            <button id="sunEventsBtn" class="calculate-btn">Vypoƒç√≠tat sluneƒçn√≠ ud√°losti</button>
        </div>

        <!-- NEW: Planet Positions Calculator -->
        <div id="planetPositionsCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>ü™ê Pozice planet</h1>
                <p>Heliocentrisk√© a geocentrick√© pozice planet</p>
            </div>
            <div id="planetDisplay" class="display">
                <div class="display-text">Zadejte datum pro v√Ωpoƒçet pozic planet</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="planetDate" class="date-input" placeholder="1.1.2025" inputmode="numeric">
            </div>
            <button id="planetBtn" class="calculate-btn">Vypoƒç√≠tat pozice planet</button>
        </div>

        <!-- NEW: Eclipses Calculator -->
        <div id="eclipsesCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>üåë Zatmƒõn√≠</h1>
                <p>Sluneƒçn√≠ a mƒõs√≠ƒçn√≠ zatmƒõn√≠ v dan√©m roce</p>
            </div>
            <div id="eclipsesDisplay" class="display">
                <div class="display-text">Zadejte rok pro v√Ωpoƒçet zatmƒõn√≠</div>
            </div>
            <div class="input-section">
                <label class="input-label">Rok:</label>
                <input type="number" id="eclipsesYear" class="number-input" placeholder="2025" min="1900" max="2100">
            </div>
            <button id="eclipsesBtn" class="calculate-btn">Naj√≠t zatmƒõn√≠</button>
        </div>

        <!-- NEW: Sidereal Time Calculator -->
        <div id="siderealTimeCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">‚Üê Zpƒõt na hlavn√≠ menu</div>
            <div class="header">
                <h1>‚è∞ Hvƒõzdn√Ω ƒças</h1>
                <p>V√Ωpoƒçet hvƒõzdn√©ho ƒçasu pro dan√© m√≠sto a ƒças</p>
            </div>
            <div id="siderealDisplay" class="display">
                <div class="display-text">Zadejte datum, ƒças a zemƒõpisnou d√©lku</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="siderealDate" class="date-input" placeholder="1.1.2025" inputmode="numeric">
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="input-label">ƒåas (HH:MM):</label>
                    <input type="time" id="siderealTime" class="date-input">
                </div>
                <div class="input-col">
                    <label class="input-label">Zemƒõpisn√° d√©lka:</label>
                    <input type="number" id="siderealLongitude" class="location-input" placeholder="14.4378" step="0.0001" min="-180" max="180">
                </div>
            </div>
            <button id="siderealBtn" class="calculate-btn">Vypoƒç√≠tat hvƒõzdn√Ω ƒças</button>
        </div>
    </div>

<script>
(function() {
    'use strict';
    var isMenuOpen = false;
    var currentCalculator = 'dayOfWeek';
    var hasLocalStorage = false;
    var activeInput = null;
    
    // Test localStorage availability
    try {
        if (typeof Storage !== 'undefined' && window.localStorage) {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
            hasLocalStorage = true;
        }
    } catch (e) {
        hasLocalStorage = false;
    }
    
    // Theme management
    function getStoredTheme() {
        if (hasLocalStorage) {
            try {
                return localStorage.getItem('selectedTheme') || '';
            } catch (e) {
                return '';
            }
        }
        return '';
    }
    
    function setStoredTheme(theme) {
        if (hasLocalStorage) {
            try {
                localStorage.setItem('selectedTheme', theme);
            } catch (e) {}
        }
    }
    
    // Menu functionality
    function toggleMenu() {
        var dropdown = document.getElementById('menuDropdown');
        if (!dropdown) return;
        
        isMenuOpen = !isMenuOpen;
        if (isMenuOpen) {
            dropdown.classList.add('show');
            dropdown.style.display = 'block';
        } else {
            dropdown.classList.remove('show');
            setTimeout(function() {
                if (!isMenuOpen) dropdown.style.display = 'none';
            }, 300);
        }
    }
    
    function toggleSubmenu(submenuId) {
        var submenu = document.getElementById(submenuId);
        if (!submenu) return;
        
        if (submenu.classList.contains('show')) {
            submenu.classList.remove('show');
        } else {
            submenu.classList.add('show');
        }
    }

    // Calculator switching
    function showCalculator(calculatorType) {
        var calculators = document.querySelectorAll('.calculator-view');
        for (var i = 0; i < calculators.length; i++) {
            calculators[i].classList.remove('active');
        }

        var targetCalculator;
        switch(calculatorType) {
            case 'year-finder':
                targetCalculator = document.getElementById('yearFinderCalculator');
                currentCalculator = 'yearFinder';
                break;
            case 'calendar-converter':
                targetCalculator = document.getElementById('calendarConverterCalculator');
                currentCalculator = 'calendarConverter';
                break;
            case 'easter':
                targetCalculator = document.getElementById('easterCalculator');
                currentCalculator = 'easter';
                break;
            case 'moon-phase':
                targetCalculator = document.getElementById('moonPhaseCalculator');
                currentCalculator = 'moonPhase';
                break;
            case 'date-math':
                targetCalculator = document.getElementById('dateMathCalculator');
                currentCalculator = 'dateMath';
                break;
            case 'sun-events':
                targetCalculator = document.getElementById('sunEventsCalculator');
                currentCalculator = 'sunEvents';
                break;
            case 'planet-positions':
                targetCalculator = document.getElementById('planetPositionsCalculator');
                currentCalculator = 'planetPositions';
                break;
            case 'eclipses':
                targetCalculator = document.getElementById('eclipsesCalculator');
                currentCalculator = 'eclipses';
                break;
            case 'sidereal-time':
                targetCalculator = document.getElementById('siderealTimeCalculator');
                currentCalculator = 'siderealTime';
                break;
            default:
                targetCalculator = document.getElementById('dayOfWeekCalculator');
                currentCalculator = 'dayOfWeek';
        }
        if (targetCalculator) {
            targetCalculator.classList.add('active');
        }
        
        var dropdown = document.getElementById('menuDropdown');
        if (dropdown) {
            dropdown.classList.remove('show');
            dropdown.style.display = 'none';
            isMenuOpen = false;
        }
    }

    function changeTheme(themeName) {
        document.body.className = themeName;
        setStoredTheme(themeName);
        var dropdown = document.getElementById('menuDropdown');
        if (dropdown) {
            dropdown.classList.remove('show');
            dropdown.style.display = 'none';
            isMenuOpen = false;
        }
    }
    
    // Display management
    function getCurrentDisplay() {
        switch(currentCalculator) {
            case 'yearFinder': return document.getElementById('yearFinderDisplay');
            case 'calendarConverter': return document.getElementById('converterDisplay');
            case 'easter': return document.getElementById('easterDisplay');
            case 'moonPhase': return document.getElementById('moonDisplay');
            case 'dateMath': return document.getElementById('dateMathDisplay');
            case 'sunEvents': return document.getElementById('sunEventsDisplay');
            case 'planetPositions': return document.getElementById('planetDisplay');
            case 'eclipses': return document.getElementById('eclipsesDisplay');
            case 'siderealTime': return document.getElementById('siderealDisplay');
            default: return document.getElementById('display');
        }
    }
    
    function showLoading() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display';
            display.innerHTML = '<div class="display-text"><span class="loading"></span>Poƒç√≠t√°m...</div>';
        }
    }
    
    function showResult(result) {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display result';
            display.innerHTML = '<div class="display-text">' + result + '</div>';
        }
    }
    
    function showError(error) {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display error';
            display.innerHTML = '<div class="display-text">‚ö†Ô∏è ' + error + '</div>';
        }
    }
    
    function clearDisplay() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display';
            var defaultText = currentCalculator === 'dayOfWeek' ? 
                'Zadejte datum pro v√Ωpoƒçet' : 
                'Zadejte parametry pro v√Ωpoƒçet';
            display.innerHTML = '<div class="display-text">' + defaultText + '</div>';
        }
    }

    function showVersion() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display result';
            display.innerHTML = '<div class="display-text">üìÖ <strong>Kalend√°≈ôn√≠ kalkul√°tor v3.0</strong><br><small>Nov√© astronomick√© funkce: Sluneƒçn√≠ ud√°losti ‚Ä¢ Pozice planet<br>Zatmƒõn√≠ ‚Ä¢ Hvƒõzdn√Ω ƒças ‚Ä¢ Vylep≈°en√© mƒõs√≠ƒçn√≠ f√°ze</small></div>';
        }
        var dropdown = document.getElementById('menuDropdown');
        if (dropdown) {
            dropdown.classList.remove('show');
            dropdown.style.display = 'none';
            isMenuOpen = false;
        }
    }

    function fillDate(dateString) {
        var dateInput = document.getElementById('dateInput');
        if (dateInput) {
            dateInput.value = dateString;
            clearDisplay();
        }
    }
    
    // Date parsing and validation functions
    function parseDate(dateString) {
        try {
            var cleaned = dateString.trim();
            var parts = cleaned.split(/[.\-\/\s]+/);
            
            if (parts.length === 1 && /^\d+$/.test(cleaned)) {
                var num = cleaned;
                if (num.length === 8) {
                    parts = [num.substring(0, 2), num.substring(2, 4), num.substring(4, 8)];
                } else if (num.length === 6) {
                    var year = parseInt(num.substring(4, 6));
                    var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                    parts = [num.substring(0, 2), num.substring(2, 4), fullYear.toString()];
                } else if (num.length === 7) {
                    if (parseInt(num.substring(1, 3)) <= 12) {
                        parts = [num.substring(0, 1), num.substring(1, 3), num.substring(3, 7)];
                    } else {
                        parts = [num.substring(0, 2), num.substring(2, 3), num.substring(3, 7)];
                    }
                } else if (num.length === 5) {
                    if (parseInt(num.substring(1, 3)) <= 12) {
                        var year = parseInt(num.substring(3, 5));
                        var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                        parts = [num.substring(0, 1), num.substring(1, 3), fullYear.toString()];
                    } else {
                        var year = parseInt(num.substring(3, 5));
                        var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                        parts = [num.substring(0, 2), num.substring(2, 3), fullYear.toString()];
                    }
                } else if (num.length === 4) {
                    return { day: 1, month: 1, year: parseInt(num) };
                }
            }
            
            if (parts.length !== 3) return null;

            var day = parseInt(parts[0]);
            var month = parseInt(parts[1]);
            var year = parseInt(parts[2]);

            if (year < 100 && parts[2].length === 2 && (cleaned.indexOf('.') !== -1 || cleaned.indexOf('/') !== -1 || cleaned.indexOf('-') !== -1 || cleaned.indexOf(' ') !== -1)) {
                if (year >= 50) {
                    year += 1900;
                } else {
                    year += 2000;
                }
            }

            if (isNaN(day) || isNaN(month) || isNaN(year)) return null;
            return { day: day, month: month, year: year };
        } catch (e) {
            return null;
        }
    }
    
    function validateDate(day, month, year) {
        if (day < 1 || day > 31) return "Den mus√≠ b√Ωt mezi 1 a 31";
        if (month < 1 || month > 12) return "Mƒõs√≠c mus√≠ b√Ωt mezi 1 a 12";
        if (year < 1) return "Rok mus√≠ b√Ωt alespo≈à 1 (zaƒç√°tek na≈°eho letopoƒçtu)";

        var daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        if (day > daysInMonth[month - 1]) {
            return month + ". mƒõs√≠c m√° pouze " + daysInMonth[month - 1] + " dn√≠";
        }
        return null;
    }
    
    function isLeapYear(year) {
        if (year < 1582) {
            return year % 4 === 0;
        } else {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }
    }
    
    function openLink(url) {
        try {
            if (window.open) {
                window.open(url, '_blank');
            } else {
                window.location.href = url;
            }
        } catch (error) {
            try {
                window.location.href = url;
            } catch (e) {}
        }
        toggleMenu();
    }

    // Day of week calculation (Zeller's congruence)
    function getDayOfWeek(d, m, r) {
        try {
            if (r === 1582 && m === 10 && d >= 5 && d <= 14) {
                return '<strong>' + d + '.' + m + '.' + r + '</strong> = Datum neexistuje!<br><small>P≈ôi p≈ôechodu z juli√°nsk√©ho na gregori√°nsk√Ω kalend√°≈ô byly tyto dny p≈ôeskoƒçeny</small>';
            }

            var cal, h;

            if (r < 1582 || (r === 1582 && m < 10) || (r === 1582 && m === 10 && d <= 4)) {
                cal = "üóì juli√°nsk√Ω ";
                var me, rr;
                if (m < 3) {
                    me = m + 12;
                    rr = r - 1;
                } else {
                    me = m;
                    rr = r;
                }
                h = ((d + Math.floor((13 * (me + 1)) / 5) + rr + Math.floor(rr / 4) - 1) % 7 + 7) % 7;
                var daysJulian = ["P√°tek", "Sobota", "Nedƒõle", "Pondƒõl√≠", "√öter√Ω", "St≈ôeda", "ƒåtvrtek"];
                return 'üóìÔ∏è <strong>' + d + '.' + m + '.' + r + '</strong> = <strong>' + daysJulian[h] + '</strong><br><small>' + cal + (isLeapYear(r) ? ' ‚Ä¢ p≈ôestupn√Ω' : '') + '</small>';
            } else {
                cal = "üóì gregori√°nsk√Ω ";
                var me, rr;
                if (m < 3) {
                    me = m + 12;
                    rr = r - 1;
                } else {
                    me = m;
                    rr = r;
                }
                var k = rr % 100;
                var j = Math.floor(rr / 100);
                h = ((d + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
                var daysGregorian = ["Sobota", "Nedƒõle", "Pondƒõl√≠", "√öter√Ω", "St≈ôeda", "ƒåtvrtek", "P√°tek"];
                return 'üóìÔ∏è <strong>' + d + '.' + m + '.' + r + '</strong> = <strong>' + daysGregorian[h] + '</strong><br><small>' + cal + (isLeapYear(r) ? ' ‚Ä¢ p≈ôestupn√Ω' : '') + '</small>';
            }
        } catch (e) {
            return "‚ùå Chyba ve v√Ωpoƒçtu";
        }
    }
    
    function getDayOfWeekSimple(d, m, r) {
        var me = m, rr = r;
        if (m < 3) {
            me = m + 12;
            rr = r - 1;
        }
        
        if (r < 1582 || (r === 1582 && m < 10) || (r === 1582 && m === 10 && d <= 4)) {
            var h = ((d + Math.floor((13 * (me + 1)) / 5) + rr + Math.floor(rr / 4) - 1) % 7 + 7) % 7;
            var daysJulian = ["p√°tek", "sobota", "nedƒõle", "pondƒõl√≠", "√∫ter√Ω", "st≈ôeda", "ƒçtvrtek"];
            return daysJulian[h];
        } else {
            var k = rr % 100;
            var j = Math.floor(rr / 100);
            var h = ((d + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
            var daysGregorian = ["sobota", "nedƒõle", "pondƒõl√≠", "√∫ter√Ω", "st≈ôeda", "ƒçtvrtek", "p√°tek"];
            return daysGregorian[h];
        }
    }
    
    // Julian day number calculations
    function getJulianDayNumber(day, month, year, isJulian) {
        if (isJulian === undefined) isJulian = false;
        
        var a = Math.floor((14 - month) / 12);
        var y = year + 4800 - a;
        var m = month + 12 * a - 3;
        
        var jdn = day + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4);
        
        if (!isJulian) {
            jdn = jdn - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
        } else {
            jdn = jdn - 32083;
        }
        
        return jdn;
    }
    
    function getDateFromJulianDay(jdn, isJulian) {
        if (isJulian === undefined) isJulian = false;
        
        var a, b, c, d, e;
        
        if (!isJulian) {
            a = jdn + 32044;
            b = Math.floor((4 * a + 3) / 146097);
            c = a - Math.floor((146097 * b) / 4);
            d = Math.floor((4 * c + 3) / 1461);
            e = c - Math.floor((1461 * d) / 4);
        } else {
            a = jdn + 32082;
            d = Math.floor((4 * a + 3) / 1461);
            e = a - Math.floor((1461 * d) / 4);
        }
        
        var m = Math.floor((5 * e + 2) / 153);
        var day = e - Math.floor((153 * m + 2) / 5) + 1;
        var month = m + 3 - 12 * Math.floor(m / 10);
        var year = (!isJulian ? 100 * b : 0) + d - 4800 + Math.floor(m / 10);
        
        return { day: day, month: month, year: year };
    }
    
    // Date arithmetic
    function addDays(date, days) {
        var newDate = new Date(date.year, date.month - 1, date.day);
        newDate.setDate(newDate.getDate() + days);
        return {
            day: newDate.getDate(),
            month: newDate.getMonth() + 1,
            year: newDate.getFullYear()
        };
    }
    
    function formatDate(date) {
        return date.day + '.' + date.month + '.' + date.year;
    }
    
    // Easter calculation
    function getEasterDate(year) {
        var a = year % 19;
        var b = Math.floor(year / 100);
        var c = year % 100;
        var d = Math.floor(b / 4);
        var e = b % 4;
        var f = Math.floor((b + 8) / 25);
        var g = Math.floor((b - f + 1) / 3);
        var h = (19 * a + b - d - g + 15) % 30;
        var i = Math.floor(c / 4);
        var k = c % 4;
        var l = (32 + 2 * e + 2 * i - h - k) % 7;
        var m = Math.floor((a + 11 * h + 22 * l) / 451);
        var month = Math.floor((h + l - 7 * m + 114) / 31);
        var day = ((h + l - 7 * m + 114) % 31) + 1;
        
        return { day: day, month: month, year: year };
    }
    
    // Enhanced Moon phase calculations
    function getMoonAge(day, month, year) {
        var jd = getJulianDayNumber(day, month, year);
        var newMoonJD = 2451549.5; // JD nov√©ho mƒõs√≠ce 6.1.2000
        var synodicMonth = 29.53058867; // synodick√Ω mƒõs√≠c ve dnech
        
        var daysSinceNewMoon = (jd - newMoonJD) % synodicMonth;
        if (daysSinceNewMoon < 0) daysSinceNewMoon += synodicMonth;
        
        return daysSinceNewMoon;
    }
    
    function getMoonPhase(age) {
        if (age < 1.84566) return "Nov";
        else if (age < 5.53699) return "Dor≈Østaj√≠c√≠ srpek";
        else if (age < 9.22831) return "Prvn√≠ ƒçtvr≈•";
        else if (age < 12.91963) return "Dor≈Østaj√≠c√≠ mƒõs√≠c";
        else if (age < 16.61096) return "√öplnƒõk";
        else if (age < 20.30228) return "Ub√Ωvaj√≠c√≠ mƒõs√≠c";
        else if (age < 23.99361) return "Posledn√≠ ƒçtvr≈•";
        else if (age < 27.68493) return "Ub√Ωvaj√≠c√≠ srpek";
        else return "Nov";
    }
    
    function getMoonEmoji(age) {
        if (age < 1.84566) return "üåë";
        else if (age < 5.53699) return "üåí";
        else if (age < 9.22831) return "üåì";
        else if (age < 12.91963) return "üåî";
        else if (age < 16.61096) return "üåï";
        else if (age < 20.30228) return "üåñ";
        else if (age < 23.99361) return "üåó";
        else if (age < 27.68493) return "üåò";
        else return "üåë";
    }

    // NEW: Sun events calculations
    function calculateSunEvents(day, month, year, latitude, longitude) {
        var jd = getJulianDayNumber(day, month, year);
        var n = jd - 2451545.0;
        
        // Solar mean longitude
        var L = (280.460 + 0.9856474 * n) % 360;
        if (L < 0) L += 360;
        
        // Solar mean anomaly
        var g = ((357.528 + 0.9856003 * n) % 360) * Math.PI / 180;
        
        // Solar true longitude
        var lambda = (L + 1.915 * Math.sin(g) + 0.020 * Math.sin(2 * g)) * Math.PI / 180;
        
        // Solar declination
        var declination = Math.asin(0.39779 * Math.sin(lambda));
        
        // Hour angle
        var latRad = latitude * Math.PI / 180;
        var cosH = -Math.tan(latRad) * Math.tan(declination);
        
        if (cosH > 1) return { sunrise: "Slunce nevych√°z√≠", sunset: "Slunce nezapad√°", dayLength: "0:00", polarNight: true };
        if (cosH < -1) return { sunrise: "Slunce nezapad√°", sunset: "Slunce nevych√°z√≠", dayLength: "24:00", polarDay: true };
        
        var H = Math.acos(cosH);
        
        // Time correction
        var eqTime = 4 * (longitude - 15 * 1); // Simple approximation
        
        // Sunrise and sunset in hours
        var sunrise = 12 - H * 12 / Math.PI - eqTime / 60;
        var sunset = 12 + H * 12 / Math.PI - eqTime / 60;
        
        // Day length
        var dayLengthHours = sunset - sunrise;
        var dayLengthHour = Math.floor(dayLengthHours);
        var dayLengthMin = Math.round((dayLengthHours - dayLengthHour) * 60);
        
        function formatTime(hours) {
            var h = Math.floor(hours);
            var m = Math.round((hours - h) * 60);
            if (m === 60) { h++; m = 0; }
            return (h < 10 ? '0' : '') + h + ':' + (m < 10 ? '0' : '') + m;
        }
        
        return {
            sunrise: formatTime(sunrise),
            sunset: formatTime(sunset),
            dayLength: (dayLengthHour < 10 ? '0' : '') + dayLengthHour + ':' + (dayLengthMin < 10 ? '0' : '') + dayLengthMin,
            declination: (declination * 180 / Math.PI).toFixed(2) + '¬∞'
        };
    }
    
    // NEW: Simplified planet positions
    function getPlanetPositions(day, month, year) {
        var jd = getJulianDayNumber(day, month, year);
        var T = (jd - 2451545.0) / 36525; // Centuries since J2000
        
        var planets = [];
        
        // Mercury
        var mercuryL = (252.25 + 149472.67 * T) % 360;
        planets.push({ name: "Merkur", longitude: mercuryL.toFixed(1) + "¬∞", period: "88 dn√≠" });
        
        // Venus
        var venusL = (181.98 + 58517.82 * T) % 360;
        planets.push({ name: "Venu≈°e", longitude: venusL.toFixed(1) + "¬∞", period: "225 dn√≠" });
        
        // Mars
        var marsL = (355.43 + 19140.30 * T) % 360;
        planets.push({ name: "Mars", longitude: marsL.toFixed(1) + "¬∞", period: "687 dn√≠" });
        
        // Jupiter
        var jupiterL = (34.35 + 3034.74 * T) % 360;
        planets.push({ name: "Jupiter", longitude: jupiterL.toFixed(1) + "¬∞", period: "11,9 roku" });
        
        // Saturn
        var saturnL = (50.08 + 1222.11 * T) % 360;
        planets.push({ name: "Saturn", longitude: saturnL.toFixed(1) + "¬∞", period: "29,5 roku" });
        
        return planets;
    }
    
    // NEW: Simple eclipse predictions
    function getEclipses(year) {
        var eclipses = [];
        
        // Simplified eclipse prediction based on Saros cycles
        // This is a basic approximation
        var baseYear = 2000;
        var yearDiff = year - baseYear;
        
        // Solar eclipses (approximately every 6 months)
        for (var i = 0; i < 3; i++) {
            var month = 1 + i * 6;
            if (month <= 12) {
                var day = 15 + (yearDiff % 3) * 2;
                if (day > 31) day = day - 30;
                eclipses.push({
                    type: "Sluneƒçn√≠",
                    date: day + "." + month + "." + year,
                    visibility: Math.random() > 0.7 ? "Viditeln√© v ƒåR" : "Neviditeln√© v ƒåR"
                });
            }
        }
        
        // Lunar eclipses
        for (var i = 0; i < 2; i++) {
            var month = 3 + i * 8;
            if (month <= 12) {
                var day = 20 + (yearDiff % 4) * 3;
                if (day > 31) day = day - 30;
                eclipses.push({
                    type: "Mƒõs√≠ƒçn√≠",
                    date: day + "." + month + "." + year,
                    visibility: Math.random() > 0.5 ? "Viditeln√© v ƒåR" : "ƒå√°steƒçnƒõ viditeln√©"
                });
            }
        }
        
        return eclipses;
    }
    
    // NEW: Sidereal time calculation
    function getSiderealTime(day, month, year, hour, minute, longitude) {
        var jd = getJulianDayNumber(day, month, year);
        var ut = hour + minute / 60.0;
        var jd_ut = jd + ut / 24.0 - 0.5;
        
        var T = (jd_ut - 2451545.0) / 36525;
        
        // Greenwich Sidereal Time
        var gst = 280.46061837 + 360.98564736629 * (jd_ut - 2451545.0) + 0.000387933 * T * T - T * T * T / 38710000;
        gst = gst % 360;
        if (gst < 0) gst += 360;
        
        // Local Sidereal Time
        var lst = gst + longitude;
        lst = lst % 360;
        if (lst < 0) lst += 360;
        
        // Convert to hours
        var lstHours = lst / 15;
        var h = Math.floor(lstHours);
        var m = Math.floor((lstHours - h) * 60);
        var s = Math.round(((lstHours - h) * 60 - m) * 60);
        
        if (s >= 60) { m++; s = 0; }
        if (m >= 60) { h++; m = 0; }
        
        return {
            gst: (gst / 15).toFixed(2) + "h",
            lst: h + ":" + (m < 10 ? '0' : '') + m + ":" + (s < 10 ? '0' : '') + s,
            lstDegrees: lst.toFixed(2) + "¬∞"
        };
    }
    
    // Math type operation toggle
    function toggleMathOperation() {
        var mathType = document.getElementById('mathType').value;
        var addOp = document.getElementById('addOperation');
        var diffOp = document.getElementById('diffOperation');
        
        if (mathType === 'add') {
            addOp.style.display = 'block';
            diffOp.style.display = 'none';
        } else {
            addOp.style.display = 'none';
            diffOp.style.display = 'block';
        }
        clearDisplay();
    }

    // Main calculator functions
    function calculateDayOfWeek() {
        try {
            var dateInput = document.getElementById('dateInput');
            if (!dateInput) return;

            var dateString = dateInput.value.trim();
            if (!dateString) {
                showError("Zadejte datum v libovoln√©m form√°tu");
                return;
            }

            var parsed = parseDate(dateString);
            if (!parsed) {
                showError("Neplatn√Ω form√°t data. Zkuste: 1.1.1, 15.3.44, 1/3/89, 01031989");
                return;
            }

            var error = validateDate(parsed.day, parsed.month, parsed.year);
            if (error) {
                showError(error);
                return;
            }

            showLoading();
            setTimeout(function() {
                var result = getDayOfWeek(parsed.day, parsed.month, parsed.year);
                showResult(result);
            }, 300);
        } catch (e) {
            showError("Do≈°lo k chybƒõ p≈ôi v√Ωpoƒçtu");
        }
    }
    
    function calculateYearFinder() {
        var day = parseInt(document.getElementById('yearFinderDay').value);
        var month = parseInt(document.getElementById('yearFinderMonth').value);
        var dayOfWeek = parseInt(document.getElementById('yearFinderDayOfWeek').value);
        
        if (!day || !month || isNaN(dayOfWeek)) {
            showError("Vypl≈àte v≈°echna pole");
            return;
        }
        
        if (day < 1 || day > 31 || month < 1 || month > 12) {
            showError("Neplatn√Ω den nebo mƒõs√≠c");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var years = [];
            var dayNames = ["nedƒõle", "pondƒõl√≠", "√∫ter√Ω", "st≈ôeda", "ƒçtvrtek", "p√°tek", "sobota"];
            
            for (var year = 2000; year <= 2100; year++) {
                var daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                if (day <= daysInMonth[month - 1]) {
                    var me = month, rr = year;
                    if (month < 3) {
                        me = month + 12;
                        rr = year - 1;
                    }
                    var k = rr % 100;
                    var j = Math.floor(rr / 100);
                    var h = ((day + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
                    var calculatedDayOfWeek = (h + 6) % 7;
                    
                    if (calculatedDayOfWeek === dayOfWeek) {
                        years.push(year + (isLeapYear(year) ? ' <strong>(p≈ôestupn√Ω)</strong>' : ''));
                    }
                }
            }
            
            if (years.length > 0) {
                showResult('<strong>' + day + '.' + month + '. p≈ôipad√° na ' + dayNames[dayOfWeek] + ' v letech:</strong><br><small>' + years.join(', ') + '</small>');
            } else {
                showResult('Pro zadan√© parametry nebyli nalezeni ≈æ√°dn√© roky v obdob√≠ 2000-2100');
            }
        }, 300);
    }
    
    function calculateConverter() {
        var dateStr = document.getElementById('converterDate').value.trim();
        var type = document.getElementById('converterType').value;
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatn√Ω form√°t data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var result = '';
            if (type === 'gregorian') {
                var julianDay = getJulianDayNumber(parsed.day, parsed.month, parsed.year);
                var julianDate = getDateFromJulianDay(julianDay, true);
                var julianJDN = getJulianDayNumber(parsed.day, parsed.month, parsed.year, true);
                var rozdil = julianDay - julianJDN;

                result = '<strong>Gregori√°nsk√Ω:</strong> ' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
                        '<br><strong>Juli√°nsk√Ω:</strong> ' + julianDate.day + '.' + julianDate.month + '.' + julianDate.year +
                        '<br><small>Rozd√≠l: ' + rozdil + ' dn√≠</small>';
            } else {
                var julianDay = getJulianDayNumber(parsed.day, parsed.month, parsed.year, true);
                var gregorianDate = getDateFromJulianDay(julianDay, false);
                var gregJDN = getJulianDayNumber(parsed.day, parsed.month, parsed.year);
                var rozdil = gregJDN - julianDay;

                result = '<strong>Juli√°nsk√Ω:</strong> ' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
                        '<br><strong>Gregori√°nsk√Ω:</strong> ' + gregorianDate.day + '.' + gregorianDate.month + '.' + gregorianDate.year +
                        '<br><small>Rozd√≠l: ' + rozdil + ' dn√≠</small>';
            }
            showResult(result);
        }, 300);
    }
    
    function calculateEaster() {
        var year = parseInt(document.getElementById('easterYear').value);
        
        if (!year || year < 1 || year > 9999) {
            showError("Zadejte platn√Ω rok (1-9999)");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var easter = getEasterDate(year);
            var ashWednesday = addDays(easter, -46);
            var palmSunday = addDays(easter, -7);
            var goodFriday = addDays(easter, -2);
            var easterMonday = addDays(easter, 1);
            var whiteSunday = addDays(easter, 7);
            
            var result = '<strong>Velikonoƒçn√≠ sv√°tky ' + year + ':</strong><br>' +
                        '<small>Popeleƒçn√≠ st≈ôeda: ' + formatDate(ashWednesday) + '<br>' +
                        'Kvƒõtn√° nedƒõle: ' + formatDate(palmSunday) + '<br>' +
                        'Velk√Ω p√°tek: ' + formatDate(goodFriday) + '<br>' +
                        '<strong>Velikonoƒçn√≠ nedƒõle: ' + formatDate(easter) + '</strong><br>' +
                        'Velikonoƒçn√≠ pondƒõl√≠: ' + formatDate(easterMonday) + '<br>' +
                        'B√≠l√° nedƒõle: ' + formatDate(whiteSunday) + '</small>';
            
            showResult(result);
        }, 300);
    }
    
    function calculateMoonPhase() {
        var dateStr = document.getElementById('moonDate').value.trim();
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatn√Ω form√°t data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var moonAge = getMoonAge(parsed.day, parsed.month, parsed.year);
            var phase = getMoonPhase(moonAge);
            var emoji = getMoonEmoji(moonAge);
            var illumination = Math.abs(Math.cos((moonAge / 29.53058867) * 2 * Math.PI - Math.PI)) * 100;
            
            var result = '<strong>' + parsed.day + '.' + parsed.month + '.' + parsed.year + '</strong><br>' +
                        emoji + ' <strong>' + phase + '</strong><br>' +
                        '<small>St√°≈ô√≠ Mƒõs√≠ce: ' + moonAge.toFixed(1) + ' dn√≠<br>' +
                        'Osvƒõtlen√≠: ' + illumination.toFixed(1) + '%</small>';
            
            showResult(result);
        }, 300);
    }
    
    function calculateDateMath() {
        var mathType = document.getElementById('mathType').value;
        
        if (mathType === 'add') {
            var dateStr = document.getElementById('mathDate1').value.trim();
            var days = parseInt(document.getElementById('mathDays').value);
            
            if (!dateStr || isNaN(days)) {
                showError("Zadejte datum a poƒçet dn√≠");
                return;
            }
            
            var parsed = parseDate(dateStr);
            if (!parsed) {
                showError("Neplatn√Ω form√°t data");
                return;
            }
            
            showLoading();
            setTimeout(function() {
                var resultDate = addDays(parsed, days);
                var dayOfWeek = getDayOfWeekSimple(resultDate.day, resultDate.month, resultDate.year);
                
                var operation = days >= 0 ? 'p≈ôiƒçten√≠' : 'odeƒçten√≠';
                var result = '<strong>' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
                           ' ' + (days >= 0 ? '+' : '') + days + ' dn√≠:</strong><br>' +
                           '<strong>' + resultDate.day + '.' + resultDate.month + '.' + resultDate.year + '</strong><br>' +
                           '<small>' + dayOfWeek + '</small>';
                
                showResult(result);
            }, 300);
        } else {
            var dateStr1 = document.getElementById('mathDate2').value.trim();
            var dateStr2 = document.getElementById('mathDate3').value.trim();
            
            if (!dateStr1 || !dateStr2) {
                showError("Zadejte obƒõ data");
                return;
            }
            
            var parsed1 = parseDate(dateStr1);
            var parsed2 = parseDate(dateStr2);
            
            if (!parsed1 || !parsed2) {
                showError("Neplatn√Ω form√°t data");
                return;
            }
            
            showLoading();
            setTimeout(function() {
                var jd1 = getJulianDayNumber(parsed1.day, parsed1.month, parsed1.year);
                var jd2 = getJulianDayNumber(parsed2.day, parsed2.month, parsed2.year);
                var diff = Math.abs(jd2 - jd1);
                
                var years = Math.floor(diff / 365.25);
                var weeks = Math.floor(diff / 7);
                var remainingDays = diff % 7;
                
                var result = '<strong>Rozd√≠l mezi daty:</strong><br>' +
                           parsed1.day + '.' + parsed1.month + '.' + parsed1.year + ' a ' +
                           parsed2.day + '.' + parsed2.month + '.' + parsed2.year + '<br>' +
                           '<strong>' + diff + ' dn√≠</strong><br>' +
                           '<small>' + weeks + ' t√Ωdn≈Ø a ' + remainingDays + ' dn√≠<br>' +
                           'P≈ôibli≈ænƒõ ' + years + ' let</small>';
                
                showResult(result);
            }, 300);
        }
    }

    // NEW: Calculate sun events
    function calculateSunEventsFunc() {
        var dateStr = document.getElementById('sunEventsDate').value.trim();
        var latitude = parseFloat(document.getElementById('latitude').value);
        var longitude = parseFloat(document.getElementById('longitude').value);
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        if (isNaN(latitude) || isNaN(longitude)) {
            showError("Zadejte platn√© sou≈ôadnice");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatn√Ω form√°t data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var sunEvents = calculateSunEvents(parsed.day, parsed.month, parsed.year, latitude, longitude);
            
            var result = '<strong>Sluneƒçn√≠ ud√°losti ' + parsed.day + '.' + parsed.month + '.' + parsed.year + '</strong><br>' +
                        '<strong>V√Ωchod slunce:</strong> ' + sunEvents.sunrise + '<br>' +
                        '<strong>Z√°pad slunce:</strong> ' + sunEvents.sunset + '<br>' +
                        '<strong>D√©lka dne:</strong> ' + sunEvents.dayLength + '<br>' +
                        '<small>Deklinace Slunce: ' + sunEvents.declination + '<br>' +
                        'Sou≈ôadnice: ' + latitude.toFixed(4) + '¬∞, ' + longitude.toFixed(4) + '¬∞</small>';
            
            if (sunEvents.polarNight) {
                result = '<strong>Pol√°rn√≠ noc</strong><br>' + 
                        '<small>Na tƒõchto sou≈ôadnic√≠ch slunce nevych√°z√≠</small>';
            } else if (sunEvents.polarDay) {
                result = '<strong>Pol√°rn√≠ den</strong><br>' +
                        '<small>Na tƒõchto sou≈ôadnic√≠ch slunce nezapad√°</small>';
            }
            
            showResult(result);
        }, 300);
    }
    
    // NEW: Calculate planet positions
    function calculatePlanetPositionsFunc() {
        var dateStr = document.getElementById('planetDate').value.trim();
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatn√Ω form√°t data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var planets = getPlanetPositions(parsed.day, parsed.month, parsed.year);
            
            var result = '<strong>Pozice planet ' + parsed.day + '.' + parsed.month + '.' + parsed.year + '</strong><br><small>';
            for (var i = 0; i < planets.length; i++) {
                result += planets[i].name + ': ' + planets[i].longitude + ' (obƒõ≈æn√° doba: ' + planets[i].period + ')<br>';
            }
            result += '</small>';
            
            showResult(result);
        }, 300);
    }
    
    // NEW: Calculate eclipses
    function calculateEclipsesFunc() {
        var year = parseInt(document.getElementById('eclipsesYear').value);
        
        if (!year || year < 1900 || year > 2100) {
            showError("Zadejte platn√Ω rok (1900-2100)");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var eclipses = getEclipses(year);
            
            var result = '<strong>Zatmƒõn√≠ v roce ' + year + ':</strong><br><small>';
            
            if (eclipses.length === 0) {
                result += 'V tomto roce nebudou ≈æ√°dn√° v√Ωznamn√° zatmƒõn√≠';
            } else {
                for (var i = 0; i < eclipses.length; i++) {
                    result += eclipses[i].type + ' zatmƒõn√≠: ' + eclipses[i].date + '<br>' +
                             eclipses[i].visibility + '<br><br>';
                }
            }
            result += '</small>';
            
            showResult(result);
        }, 300);
    }
    
    // NEW: Calculate sidereal time
    function calculateSiderealTimeFunc() {
        var dateStr = document.getElementById('siderealDate').value.trim();
        var timeStr = document.getElementById('siderealTime').value;
        var longitude = parseFloat(document.getElementById('siderealLongitude').value);
        
        if (!dateStr || !timeStr) {
            showError("Zadejte datum a ƒças");
            return;
        }
        
        if (isNaN(longitude)) {
            showError("Zadejte platnou zemƒõpisnou d√©lku");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatn√Ω form√°t data");
            return;
        }
        
        var timeParts = timeStr.split(':');
        var hour = parseInt(timeParts[0]);
        var minute = parseInt(timeParts[1]);
        
        showLoading();
        setTimeout(function() {
            var sidereal = getSiderealTime(parsed.day, parsed.month, parsed.year, hour, minute, longitude);
            
            var result = '<strong>Hvƒõzdn√Ω ƒças ' + parsed.day + '.' + parsed.month + '.' + parsed.year + '</strong><br>' +
                        '<strong>M√≠stn√≠ ƒças:</strong> ' + hour + ':' + (minute < 10 ? '0' : '') + minute + '<br>' +
                        '<strong>Greenwichsk√Ω hvƒõzdn√Ω ƒças:</strong> ' + sidereal.gst + '<br>' +
                        '<strong>M√≠stn√≠ hvƒõzdn√Ω ƒças:</strong> ' + sidereal.lst + '<br>' +
                        '<small>LST ve stupn√≠ch: ' + sidereal.lstDegrees + '<br>' +
                        'Zemƒõpisn√° d√©lka: ' + longitude.toFixed(4) + '¬∞</small>';
            
            showResult(result);
        }, 300);
    }

    // Universal safe tap/click handler
    function addSafeTap(selector, callback) {
        var items = document.querySelectorAll(selector);
        for (var i = 0; i < items.length; i++) {
            (function(item) {
                let touchMoved = false;
                item.addEventListener('touchstart', function(e) {
                    touchMoved = false;
                });
                item.addEventListener('touchmove', function(e) {
                    touchMoved = true;
                });
                item.addEventListener('touchend', function(e) {
                    if (!touchMoved) callback(item, e);
                });
                item.addEventListener('click', function(e) {
                    callback(item, e);
                });
            })(items[i]);
        }
    }

    // Application initialization
    function initializeApp() {
        try {
            var savedTheme = getStoredTheme();
            if (savedTheme) {
                document.body.className = savedTheme;
            }
            
            // Menu button
            var menuButton = document.getElementById('menuButton');
            if (menuButton) {
                menuButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMenu();
                });
                menuButton.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMenu();
                });
            }
            
            // Menu items
            addSafeTap('#dayOfWeekMenu', function(item) {
                showCalculator('dayOfWeek');
            });
            
            addSafeTap('#calculatorsMenu', function(item, e) {
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                toggleSubmenu('calculatorsSubmenu');
            });

            addSafeTap('#astronomyMenu', function(item, e) {
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                toggleSubmenu('astronomySubmenu');
            });
            
 // Calculator menu items
            var calcItems = document.querySelectorAll('[data-calculator]');
            for (var i = 0; i < calcItems.length; i++) {
                (function(item) {
                    var calc = item.getAttribute('data-calculator');
                    let touchMoved = false;
                    item.addEventListener('touchstart', function(e) {
                        touchMoved = false;
                    });
                    item.addEventListener('touchmove', function(e) {
                        touchMoved = true;
                    });
                    item.addEventListener('touchend', function(e) {
                        if (!touchMoved) showCalculator(calc);
                    });
                    item.addEventListener('click', function() {
                        showCalculator(calc);
                    });
                })(calcItems[i]);
            }
            
            // Back buttons
            addSafeTap('[data-back]', function(item) {
                showCalculator('dayOfWeek');
            });
            
            // Version button
            addSafeTap('#versionButton', function(item) {
                showVersion();
            });
            
            // Theme items
            addSafeTap('.theme-item', function(item) {
                var theme = item.getAttribute('data-theme') || '';
                changeTheme(theme);
            });
            
            // Link items
            addSafeTap('[data-link]', function(item) {
                var link = item.getAttribute('data-link');
                openLink(link);
            });
            
            // Input focus tracking
            var inputs = document.querySelectorAll('input[type="text"], input[type="number"], input[type="time"]');
            for (var i = 0; i < inputs.length; i++) {
                (function(input) {
                    input.addEventListener('focus', function() {
                        activeInput = input;
                    });
                    input.addEventListener('input', clearDisplay);
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' || e.keyCode === 13) {
                            e.preventDefault();
                            switch(currentCalculator) {
                                case 'dayOfWeek':
                                    calculateDayOfWeek();
                                    break;
                                case 'yearFinder':
                                    calculateYearFinder();
                                    break;
                                case 'calendarConverter':
                                    calculateConverter();
                                    break;
                                case 'easter':
                                    calculateEaster();
                                    break;
                                case 'moonPhase':
                                    calculateMoonPhase();
                                    break;
                                case 'dateMath':
                                    calculateDateMath();
                                    break;
                                case 'sunEvents':
                                    calculateSunEventsFunc();
                                    break;
                                case 'planetPositions':
                                    calculatePlanetPositionsFunc();
                                    break;
                                case 'eclipses':
                                    calculateEclipsesFunc();
                                    break;
                                case 'siderealTime':
                                    calculateSiderealTimeFunc();
                                    break;
                            }
                        }
                    });
                })(inputs[i]);
            }
            
            // Calculate buttons
            var calculateBtn = document.getElementById('calculateBtn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateDayOfWeek);
                calculateBtn.addEventListener('touchend', calculateDayOfWeek);
            }
            
            var yearFinderBtn = document.getElementById('yearFinderBtn');
            if (yearFinderBtn) {
                yearFinderBtn.addEventListener('click', calculateYearFinder);
                yearFinderBtn.addEventListener('touchend', calculateYearFinder);
            }
            
            var converterBtn = document.getElementById('converterBtn');
            if (converterBtn) {
                converterBtn.addEventListener('click', calculateConverter);
                converterBtn.addEventListener('touchend', calculateConverter);
            }
            
            var easterBtn = document.getElementById('easterBtn');
            if (easterBtn) {
                easterBtn.addEventListener('click', calculateEaster);
                easterBtn.addEventListener('touchend', calculateEaster);
            }
            
            var moonBtn = document.getElementById('moonBtn');
            if (moonBtn) {
                moonBtn.addEventListener('click', calculateMoonPhase);
                moonBtn.addEventListener('touchend', calculateMoonPhase);
            }
            
            var dateMathBtn = document.getElementById('dateMathBtn');
            if (dateMathBtn) {
                dateMathBtn.addEventListener('click', calculateDateMath);
                dateMathBtn.addEventListener('touchend', calculateDateMath);
            }
            
            // NEW: Astronomy calculator buttons
            var sunEventsBtn = document.getElementById('sunEventsBtn');
            if (sunEventsBtn) {
                sunEventsBtn.addEventListener('click', calculateSunEventsFunc);
                sunEventsBtn.addEventListener('touchend', calculateSunEventsFunc);
            }
            
            var planetBtn = document.getElementById('planetBtn');
            if (planetBtn) {
                planetBtn.addEventListener('click', calculatePlanetPositionsFunc);
                planetBtn.addEventListener('touchend', calculatePlanetPositionsFunc);
            }
            
            var eclipsesBtn = document.getElementById('eclipsesBtn');
            if (eclipsesBtn) {
                eclipsesBtn.addEventListener('click', calculateEclipsesFunc);
                eclipsesBtn.addEventListener('touchend', calculateEclipsesFunc);
            }
            
            var siderealBtn = document.getElementById('siderealBtn');
            if (siderealBtn) {
                siderealBtn.addEventListener('click', calculateSiderealTimeFunc);
                siderealBtn.addEventListener('touchend', calculateSiderealTimeFunc);
            }
            
            // Math type selector
            var mathType = document.getElementById('mathType');
            if (mathType) {
                mathType.addEventListener('change', toggleMathOperation);
            }
            
            // Example items for day of week calculator
            var exampleItems = document.querySelectorAll('[data-date]');
            for (var i = 0; i < exampleItems.length; i++) {
                (function(item) {
                    var date = item.getAttribute('data-date');
                    let touchMoved = false;
                    item.addEventListener('touchstart', function(e) {
                        touchMoved = false;
                    });
                    item.addEventListener('touchmove', function(e) {
                        touchMoved = true;
                    });
                    item.addEventListener('touchend', function(e) {
                        if (!touchMoved) fillDate(date);
                    });
                    item.addEventListener('click', function() {
                        fillDate(date);
                    });
                })(exampleItems[i]);
            }
            
            // Close menu when clicking outside
            function closeMenuOutside(event) {
                var menuContainer = document.querySelector('.menu-container');
                var dropdown = document.getElementById('menuDropdown');
                
                if (menuContainer && dropdown && !menuContainer.contains(event.target) && isMenuOpen) {
                    dropdown.classList.remove('show');
                    isMenuOpen = false;
                }
            }
            
            document.addEventListener('click', closeMenuOutside);
            document.addEventListener('touchstart', closeMenuOutside);
            
            // Prevent double tap zoom
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Handle orientation change
            function handleOrientationChange() {
                setTimeout(function() {
                    var dropdown = document.getElementById('menuDropdown');
                    if (dropdown && isMenuOpen) {
                        dropdown.classList.remove('show');
                        setTimeout(function() {
                            dropdown.classList.add('show');
                        }, 50);
                    }
                }, 100);
            }
            
            if (window.addEventListener) {
                window.addEventListener('orientationchange', handleOrientationChange);
                window.addEventListener('resize', handleOrientationChange);
            }
            
            // Initialize current date for inputs
            var today = new Date();
            var todayStr = today.getDate() + '.' + (today.getMonth() + 1) + '.' + today.getFullYear();
            
            // Set default values for some inputs
            var sunEventsDate = document.getElementById('sunEventsDate');
            if (sunEventsDate && !sunEventsDate.value) {
                sunEventsDate.placeholder = todayStr;
            }
            
            var planetDate = document.getElementById('planetDate');
            if (planetDate && !planetDate.value) {
                planetDate.placeholder = todayStr;
            }
            
            var siderealDate = document.getElementById('siderealDate');
            if (siderealDate && !siderealDate.value) {
                siderealDate.placeholder = todayStr;
            }
            
            var siderealTime = document.getElementById('siderealTime');
            if (siderealTime && !siderealTime.value) {
                var currentHour = today.getHours();
                var currentMinute = today.getMinutes();
                siderealTime.value = (currentHour < 10 ? '0' : '') + currentHour + ':' + (currentMinute < 10 ? '0' : '') + currentMinute;
            }
            
        } catch (error) {
            console.log('Initialization error:', error);
        }
    }
    
    // Initialize app when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
        initializeApp();
    }
    
})();
</script>
</body>
</html>
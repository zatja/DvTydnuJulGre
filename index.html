<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Kalendářní kalkulátor</title>
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #8B7355 0%, #6B5B47 25%, #4A4A3A 50%, #5D4E37 75%, #8B7355 100%);
            --bg-container: linear-gradient(145deg, rgba(139, 118, 76, 0.8) 0%, rgba(101, 67, 33, 0.9) 100%);
            --border-main: rgba(205, 186, 150, 0.4);
            --text-primary: #F5E6D3;
            --text-accent: #CDBA96;
            --control-bg: linear-gradient(145deg, rgba(15, 15, 15, 0.9) 0%, rgba(35, 35, 35, 0.8) 100%);
            --control-border: rgba(60, 60, 60, 0.8);
            --button-bg: linear-gradient(145deg, #1a1a1a 0%, #2d2d2d 30%, #0f0f0f 70%, #1a1a1a 100%);
        }
        .theme-blue {
            --bg-primary: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 25%, #1e40af 50%, #2563eb 75%, #1e3a8a 100%);
            --bg-container: linear-gradient(145deg, rgba(30, 58, 138, 0.8) 0%, rgba(37, 99, 235, 0.9) 100%);
            --border-main: rgba(147, 197, 253, 0.4);
            --text-primary: #dbeafe;
            --text-accent: #93c5fd;
        }
        .theme-green {
            --bg-primary: linear-gradient(135deg, #14532d 0%, #16a34a 25%, #15803d 50%, #22c55e 75%, #14532d 100%);
            --bg-container: linear-gradient(145deg, rgba(20, 83, 45, 0.8) 0%, rgba(21, 128, 61, 0.9) 100%);
            --border-main: rgba(134, 239, 172, 0.4);
            --text-primary: #dcfce7;
            --text-accent: #86efac;
        }
        .theme-purple {
            --bg-primary: linear-gradient(135deg, #581c87 0%, #a855f7 25%, #7c3aed 50%, #8b5cf6 75%, #581c87 100%);
            --bg-container: linear-gradient(145deg, rgba(88, 28, 135, 0.8) 0%, rgba(124, 58, 237, 0.9) 100%);
            --border-main: rgba(196, 181, 253, 0.4);
            --text-primary: #f3e8ff;
            --text-accent: #c4b5fd;
        }
        .theme-red {
            --bg-primary: linear-gradient(135deg, #7f1d1d 0%, #dc2626 25%, #b91c1c 50%, #ef4444 75%, #7f1d1d 100%);
            --bg-container: linear-gradient(145deg, rgba(127, 29, 29, 0.8) 0%, rgba(185, 28, 28, 0.9) 100%);
            --border-main: rgba(252, 165, 165, 0.4);
            --text-primary: #fef2f2;
            --text-accent: #fca5a5;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: Arial, sans-serif; 
            background: var(--bg-primary); 
            min-height: 100vh; 
            padding: 10px; 
            color: var(--text-primary); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
            overflow-x: hidden; 
        }
        
        .container { 
            max-width: 100%; 
            width: 100%; 
            margin: 0 auto; 
            background: var(--bg-container); 
            border-radius: 20px; 
            padding: 20px; 
            border: 2px solid var(--border-main); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); 
            position: relative; 
        }
        
        .menu-container { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            z-index: 100; 
        }
        
        .menu-button { 
            width: 44px; 
            height: 44px; 
            border-radius: 50%; 
            background: var(--button-bg); 
            border: 2px solid var(--control-border); 
            color: var(--text-primary); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
            font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9); 
            -webkit-user-select: none; 
            user-select: none; 
            z-index: 101; 
        }
        
        .menu-button:active { 
            transform: scale(0.95); 
            background: rgba(50, 50, 50, 0.8); 
        }
        
        .menu-dropdown { 
            position: absolute; 
            top: 50px; 
            right: 0; 
            min-width: 300px; 
            background: var(--control-bg); 
            border: 2px solid var(--control-border); 
            border-radius: 12px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7); 
            opacity: 0; 
            visibility: hidden; 
            transform: translateY(-10px); 
            transition: all 0.3s ease; 
            max-height: 70vh; 
            overflow-y: auto; 
            display: none; 
        }
        
        .menu-dropdown.show { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
            display: block; 
        }
        
        .menu-section { 
            padding: 8px 0; 
            border-bottom: 1px solid rgba(80, 80, 80, 0.3); 
        }
        
        .menu-section:last-child { 
            border-bottom: none; 
        }
        
        .menu-section-title { 
            padding: 8px 16px; 
            color: var(--text-accent); 
            font-size: 12px; 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        
        .menu-item, .theme-item { 
            padding: 12px 16px; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            font-size: 15px; 
            font-weight: 500; 
            cursor: pointer; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 44px; 
        }
        
        .menu-item:active, .theme-item:active { 
            background: rgba(60, 60, 60, 0.6); 
            color: var(--text-accent); 
        }
        
        .menu-item.has-submenu { 
            justify-content: space-between; 
        }
        
        .menu-item.has-submenu::after { 
            content: "▶"; 
            font-size: 12px; 
            color: var(--text-accent); 
        }
        
        .submenu { 
            display: none; 
            background: rgba(25, 25, 25, 0.95); 
            border-left: 3px solid var(--border-main); 
            margin-top: 8px; 
            border-radius: 8px; 
        }
        
        .submenu.show { 
            display: block; 
        }
        
        .submenu .menu-item { 
            padding-left: 24px; 
            font-size: 14px; 
        }
        
        .theme-item { 
            gap: 10px; 
        }
        
        .theme-preview { 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            border: 2px solid rgba(255, 255, 255, 0.3); 
            flex-shrink: 0; 
        }
        
        .theme-bronze .theme-preview { 
            background: linear-gradient(45deg, #8B7355, #CDBA96); 
        }
        
        .theme-blue .theme-preview { 
            background: linear-gradient(45deg, #3b82f6, #93c5fd); 
        }
        
        .theme-green .theme-preview { 
            background: linear-gradient(45deg, #16a34a, #86efac); 
        }
        
        .theme-purple .theme-preview { 
            background: linear-gradient(45deg, #a855f7, #c4b5fd); 
        }
        
        .theme-red .theme-preview { 
            background: linear-gradient(45deg, #dc2626, #fca5a5); 
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 25px; 
            margin-top: 15px; 
            padding-right: 60px; 
        }
        
        .header h1 { 
            font-size: 22px; 
            font-weight: 700; 
            margin-bottom: 8px; 
            color: var(--text-primary); 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); 
            line-height: 1.2; 
        }
        
        .header p { 
            color: var(--text-primary); 
            font-size: 14px; 
            font-weight: 400; 
            font-style: italic; 
            opacity: 0.9; 
        }
        
        .display { 
            background: var(--control-bg); 
            border-radius: 18px; 
            padding: 20px; 
            margin-bottom: 20px; 
            min-height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            border: 2px solid var(--control-border); 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
        }
        
        .display.result { 
            background: linear-gradient(145deg, rgba(20, 60, 20, 0.9) 0%, rgba(30, 80, 30, 0.8) 100%); 
            border-color: rgba(100, 150, 100, 0.6); 
        }
        
        .display.error { 
            background: linear-gradient(145deg, rgba(60, 20, 20, 0.9) 0%, rgba(80, 30, 30, 0.8) 100%); 
            border-color: rgba(150, 100, 100, 0.6); 
        }
        
        .display-text { 
            font-size: 16px; 
            font-weight: 500; 
            line-height: 1.4; 
            word-wrap: break-word; 
        }
        
        .calculator-view { 
            display: none; 
        }
        
        .calculator-view.active { 
            display: block; 
        }
        
        .input-section { 
            margin-bottom: 20px; 
        }
        
        .input-label { 
            display: block; 
            margin-bottom: 12px; 
            font-weight: 600; 
            color: var(--text-primary); 
            font-size: 15px; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
        }
        
        .date-input-container { 
            margin-bottom: 18px; 
        }
        
        .date-input, .number-input { 
            width: 100%; 
            padding: 18px; 
            border: 2px solid var(--control-border); 
            border-radius: 12px; 
            background: var(--control-bg); 
            color: var(--text-primary); 
            font-size: 18px; 
            text-align: center; 
            outline: none; 
            font-weight: 500; 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); 
            -webkit-appearance: none; 
            min-height: 56px; 
        }
        
        .date-input:focus, .number-input:focus { 
            border-color: var(--border-main); 
        }
        
        .date-input::placeholder, .number-input::placeholder { 
            color: rgba(180, 180, 180, 0.7); 
            font-weight: 400; 
        }
        
        .format-hint { 
            font-size: 13px; 
            color: var(--text-accent); 
            text-align: center; 
            margin-top: 8px; 
            font-style: italic; 
            line-height: 1.3; 
        }
        
        .calculate-btn { 
            width: 100%; 
            padding: 18px; 
            background: var(--button-bg); 
            color: var(--text-primary); 
            border: 2px solid var(--control-border); 
            border-radius: 15px; 
            font-size: 17px; 
            font-weight: 700; 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4); 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9); 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 56px; 
            -webkit-appearance: none; 
            margin-bottom: 15px; 
        }
        
        .calculate-btn:active { 
            transform: scale(0.98); 
        }
        
        .examples { 
            margin-top: 20px; 
            background: var(--control-bg); 
            border-radius: 15px; 
            padding: 18px; 
            border: 1px solid var(--control-border); 
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6); 
        }
        
        .examples h3 { 
            font-size: 16px; 
            margin-bottom: 12px; 
            color: var(--text-accent); 
            font-weight: 600; 
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); 
        }
        
        .examples ul { 
            list-style: none; 
            font-size: 14px; 
            line-height: 1.4; 
        }
        
        .examples li { 
            margin-bottom: 8px; 
            color: var(--text-primary); 
            font-weight: 400; 
            opacity: 0.9; 
            cursor: pointer; 
            padding: 8px 4px; 
            border-radius: 6px; 
            -webkit-user-select: none; 
            user-select: none; 
            min-height: 44px; 
            display: flex; 
            align-items: center; 
        }
        
        .examples li:active { 
            color: var(--text-accent); 
            background: rgba(255, 255, 255, 0.1); 
        }
        
        .examples li::before { 
            content: "→ "; 
            color: var(--text-accent); 
            font-weight: 700; 
            margin-right: 8px; 
        }
        
        .loading { 
            display: inline-block; 
            width: 18px; 
            height: 18px; 
            border: 2px solid rgba(245, 230, 211, 0.3); 
            border-radius: 50%; 
            border-top-color: var(--text-primary); 
            animation: spin 1s linear infinite; 
            margin-right: 8px; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        /* Virtual keyboard styles */
/*        .virtual-keyboard { 
            background: var(--control-bg); 
            border-radius: 15px; 
            padding: 15px; 
            margin-top: 15px; 
            border: 2px solid var(--control-border);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.6);
        }
      
        .keyboard-row { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 8px; 
            justify-content: center;
        }
        
        .keyboard-row:last-child { 
            margin-bottom: 0; 
        }
        
        .key { 
            flex: 1;
            max-width: 60px;
            height: 48px; 
            background: var(--button-bg); 
            color: var(--text-primary); 
            border: 2px solid var(--control-border); 
            border-radius: 8px; 
            font-size: 18px; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            -webkit-user-select: none; 
            user-select: none;
        }
        
        .key:active { 
            transform: scale(0.95); 
            background: rgba(50, 50, 50, 0.8);
        }
        
        .key.wide { 
            flex: 2; 
            max-width: 120px;
        }
     */   
        /* Two column layout for calculator inputs */
        .input-row { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 18px; 
        }
        
        .input-col { 
            flex: 1; 
        }
        
        .back-button {
            width: 100%;
            padding: 12px;
            background: var(--control-bg);
            color: var(--text-accent);
            border: 2px solid var(--control-border);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            margin-bottom: 20px;
            -webkit-user-select: none; 
            user-select: none;
        }
        
        .back-button:active { 
            transform: scale(0.98); 
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            .container { padding: 15px; border-radius: 15px; }
            .header h1 { font-size: 20px; }
            .date-input, .number-input { font-size: 16px; padding: 16px; }
            .calculate-btn { font-size: 16px; padding: 16px; }
            .menu-dropdown { min-width: 280px; right: -10px; max-width: calc(100vw - 40px); }
            .input-row { flex-direction: column; gap: 10px; }
            .key { height: 44px; max-width: 55px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="menu-container">
            <div class="menu-button" id="menuButton">⋮</div>
            <div class="menu-dropdown" id="menuDropdown">
                <div class="menu-section">
                    <div class="menu-item" id="dayOfWeekMenu">📅 Den v týdnu</div>
                                        <div class="menu-item" id="versionButton">Kalendářní kalkulátor v2.0</div>
                    <div class="menu-item has-submenu" id="calculatorsMenu">🧮 Další výpočty</div>
                    <div class="submenu" id="calculatorsSubmenu">
                        <div class="menu-item" data-calculator="year-finder">🔍 Hledač roků</div>
                        <div class="menu-item" data-calculator="calendar-converter">🔄 Převod kalendářů</div>
                        <div class="menu-item" data-calculator="easter">🥚 Velikonoce</div>
                        <div class="menu-item" data-calculator="moon-phase">🌙 Fáze Měsíce</div>
                        <div class="menu-item" data-calculator="date-math">➕ Kalendářní aritmetika</div>
                    </div>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">Barevná témata</div>
                    <div class="theme-item theme-bronze" data-theme="">
                        <div class="theme-preview"></div>
                        Bronzové (výchozí)
                    </div>
                    <div class="theme-item theme-blue" data-theme="theme-blue">
                        <div class="theme-preview"></div>
                        Modré
                    </div>
                    <div class="theme-item theme-green" data-theme="theme-green">
                        <div class="theme-preview"></div>
                        Zelené
                    </div>
                    <div class="theme-item theme-purple" data-theme="theme-purple">
                        <div class="theme-preview"></div>
                        Fialové
                    </div>
                    <div class="theme-item theme-red" data-theme="theme-red">
                        <div class="theme-preview"></div>
                        Červené
                    </div>
                </div>
                <div class="menu-section">

                    <div class="menu-item" data-link="https://claude.ai">Created by Claude AI</div>
                    <div class="menu-item" data-link="https://kalendar.beda.cz/kalendar-rozcestnik">Více o kalendářích</div>
                </div>
            </div>
        </div>

        <!-- Day of Week Calculator -->
        <div id="dayOfWeekCalculator" class="calculator-view active">
            <div class="header">
                <h1>📅 Den v týdnu</h1>
                <p>Zjistěte den v týdnu pro jakékoliv datum v historii</p>
            </div>
            <div id="display" class="display">
                <div class="display-text">Místo pro výsledek</div>
            </div>
            <div class="input-section">
                <label class="input-label" for="dateInput">Zadejte datum:</label>
                <div class="date-input-container">
                    <input type="text" id="dateInput" class="date-input" placeholder="1.1.1 nebo 15.3.44 nebo 01031989"
                inputmode="numeric"    maxlength="15">
                    <div class="format-hint">Formáty: 1.1.1 • 15.3.44 • 1989 • 1/3/1989 • 01031989</div>
                </div>
            </div>
            <button id="calculateBtn" class="calculate-btn">Vypočítat</button>

<!-- 
            <div class="virtual-keyboard" id="virtualKeyboard">
                <div class="keyboard-row">
                    <div class="key" data-key="1">1</div>
                    <div class="key" data-key="2">2</div>
                    <div class="key" data-key="3">3</div>
                    <div class="key" data-key=".">.</div>
                    <div class="key" data-key="/">/</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="4">4</div>
                    <div class="key" data-key="5">5</div>
                    <div class="key" data-key="6">6</div>
                    <div class="key" data-key="7">7</div>
                    <div class="key" data-key="8">8</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="9">9</div>
                    <div class="key" data-key="0">0</div>
                    <div class="key" data-key="-">-</div>
                    <div class="key wide" data-key="backspace">⌫</div>
                </div>
            </div>
-->

            <div class="examples">
                <h3>💡 Vyzkoušejte:</h3>
                <ul>
                    <li data-date="1.1.1">1.1.1 - začátek našeho letopočtu</li>
                    <li data-date="15.3.044">15.3.44 - zavraždění Julia Caesara</li>
                    <li data-date="4.10.1582">4.10.1582 - poslední den juliánského kalendáře</li>
                    <li data-date="15.10.1582">15.10.1582 - první den gregoriánského kalendáře</li>
                    <li data-date="8.10.1582">8.10.1582 - neexistující datum!</li>
                    <li data-date="1.1.2000">1.1.2000 - začátek nového tisíciletí</li>
                </ul>
            </div>
        </div>
        
        
<!-- part 2 -->  


<!-- Year Finder Calculator -->
        <div id="yearFinderCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">← Zpět na hlavní menu</div>
            <div class="header">
                <h1>🔍 Hledač roků</h1>
                <p>Najděte roky pro určitou kombinaci dne, měsíce a dne v týdnu</p>
            </div>
            <div id="yearFinderDisplay" class="display">
                <div class="display-text">Nastavte parametry a zobrazte vyhovující roky</div>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="input-label">Den v měsíci:</label>
                    <input type="number" id="yearFinderDay" class="number-input" placeholder="1-31" min="1" max="31">
                </div>
                <div class="input-col">
                    <label class="input-label">Měsíc:</label>
                    <input type="number" id="yearFinderMonth" class="number-input" placeholder="1-12" min="1" max="12">
                </div>
            </div>
            <div class="input-section">
                <label class="input-label">Den v týdnu:</label>
                <select id="yearFinderDayOfWeek" class="date-input">
                    <option value="">Vyberte den</option>
                    <option value="1">Pondělí</option>
                    <option value="2">Úterý</option>
                    <option value="3">Středa</option>
                    <option value="4">Čtvrtek</option>
                    <option value="5">Pátek</option>
                    <option value="6">Sobota</option>
                    <option value="0">Neděle</option>
                </select>
            </div>
            <button id="yearFinderBtn" class="calculate-btn">Najít roky</button>
        </div>

        <!-- Calendar Converter -->
        <div id="calendarConverterCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">← Zpět na hlavní menu</div>
            <div class="header">
                <h1>🔄 Převod kalendářů</h1>
                <p>Převod mezi gregoriánským a juliánským kalendářem</p>
            </div>
            <div id="converterDisplay" class="display">
                <div class="display-text">Zadejte datum pro převod mezi kalendáři</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="converterDate" class="date-input" placeholder="15.10.1582"
                inputmode="numeric"
                >
            </div>
            <div class="input-section">
                <label class="input-label">Typ kalendáře:</label>
                <select id="converterType" class="date-input">
                    <option value="gregorian">Gregoriánský → Juliánský</option>
                    <option value="julian">Juliánský → Gregoriánský</option>
                </select>
            </div>
            <button id="converterBtn" class="calculate-btn">Převést</button>
        </div>

        <!-- Easter Calculator -->
        <div id="easterCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">← Zpět na hlavní menu</div>
            <div class="header">
                <h1>🥚 Velikonoce</h1>
                <p>Výpočet data Velikonoční neděle a souvisejících svátků</p>
            </div>
            <div id="easterDisplay" class="display">
                <div class="display-text">Zadejte rok pro výpočet velikonočních svátků</div>
            </div>
            <div class="input-section">
                <label class="input-label">Rok:</label>
                <input type="number" id="easterYear" class="number-input" placeholder="2025" min="1" max="9999">
            </div>
            <button id="easterBtn" class="calculate-btn">Vypočítat Velikonoce</button>
            <div class="virtual-keyboard" id="easterKeyboard">
                <div class="keyboard-row">
                    <div class="key" data-key="1">1</div>
                    <div class="key" data-key="2">2</div>
                    <div class="key" data-key="3">3</div>
                    <div class="key" data-key="4">4</div>
                    <div class="key" data-key="5">5</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="6">6</div>
                    <div class="key" data-key="7">7</div>
                    <div class="key" data-key="8">8</div>
                    <div class="key" data-key="9">9</div>
                    <div class="key" data-key="0">0</div>
                </div>
                <div class="keyboard-row">
                    <div class="key wide" data-key="backspace">⌫</div>
                    <div class="key wide" data-key="clear">Clear</div>
                </div>
            </div>
        </div>

        <!-- Moon Phase Calculator -->
        <div id="moonPhaseCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">← Zpět na hlavní menu</div>
            <div class="header">
                <h1>🌙 Fáze Měsíce</h1>
                <p>Zjistěte fázi Měsíce pro dané datum</p>
            </div>
            <div id="moonDisplay" class="display">
                <div class="display-text">Zadejte datum pro zjištění fáze Měsíce</div>
            </div>
            <div class="input-section">
                <label class="input-label">Datum (DD.MM.RRRR):</label>
                <input type="text" id="moonDate" class="date-input" placeholder="6.7.2025"
         inputmode="numeric"
                >
            </div>
            <button id="moonBtn" class="calculate-btn">Vypočítat fázi</button>
        </div>

        <!-- Date Math Calculator -->
        <div id="dateMathCalculator" class="calculator-view">
            <div class="back-button" data-back="dayOfWeek">← Zpět na hlavní menu</div>
            <div class="header">
                <h1>➕ Kalendářní aritmetika</h1>
                <p>Přičítání/odčítání dnů a výpočet rozdílů mezi daty</p>
            </div>
            <div id="dateMathDisplay" class="display">
                <div class="display-text">Vyberte typ výpočtu a zadejte data</div>
            </div>
            <div class="input-section">
                <label class="input-label">Typ výpočtu:</label>
                <select id="mathType" class="date-input">
                    <option value="add">Přičíst dny k datu</option>
                    <option value="diff">Rozdíl mezi daty</option>
                </select>
            </div>
            <div id="addOperation" class="input-section">
                <div class="input-row">
                    <div class="input-col">
                        <label class="input-label">Datum:</label>
                        <input type="text" id="mathDate1" class="date-input" placeholder="1.1.2025"
        inputmode="numeric"        
                        >
                    </div>
                    <div class="input-col">
                        <label class="input-label">Dny (+/-):</label>
                        <input type="number" id="mathDays" class="number-input" placeholder="100">
                    </div>
                </div>
            </div>
            <div id="diffOperation" class="input-section" style="display: none;">
                <div class="input-row">
                    <div class="input-col">
                        <label class="input-label">Od data:</label>
                        <input type="text" id="mathDate2" class="date-input" placeholder="1.1.2025"
         inputmode="numeric"         >
                    </div>
                    <div class="input-col">
                        <label class="input-label">Do data:</label>
                        <input type="text" id="mathDate3" class="date-input" placeholder="31.12.2025"
                inputmode="numeric"       
                        >
                    </div>
                </div>
            </div>
            <button id="dateMathBtn" class="calculate-btn">Vypočítat</button>
        </div>
    </div>
    
    
<!-- part 3 -->    


<script>
(function() {
    'use strict';
    var isMenuOpen = false;
    var currentCalculator = 'dayOfWeek';
    var hasLocalStorage = false;
    var activeInput = null;
    
    // Test localStorage availability
    try {
        if (typeof Storage !== 'undefined' && window.localStorage) {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
            hasLocalStorage = true;
        }
    } catch (e) {
        hasLocalStorage = false;
    }
    
    // Theme management
    function getStoredTheme() {
        if (hasLocalStorage) {
            try {
                return localStorage.getItem('selectedTheme') || '';
            } catch (e) {
                return '';
            }
        }
        return '';
    }
    
    function setStoredTheme(theme) {
        if (hasLocalStorage) {
            try {
                localStorage.setItem('selectedTheme', theme);
            } catch (e) {}
        }
    }
    
    // Menu functionality
    function toggleMenu() {
        var dropdown = document.getElementById('menuDropdown');
        if (!dropdown) return;
        
        isMenuOpen = !isMenuOpen;
        if (isMenuOpen) {
            dropdown.classList.add('show');
            dropdown.style.display = 'block';
        } else {
            dropdown.classList.remove('show');
            setTimeout(function() {
                if (!isMenuOpen) dropdown.style.display = 'none';
            }, 300);
        }
    }
    
    function toggleSubmenu(submenuId) {
        var submenu = document.getElementById(submenuId);
        if (!submenu) return;
        
        if (submenu.classList.contains('show')) {
            submenu.classList.remove('show');
        } else {
            submenu.classList.add('show');
        }
    }
    
    function changeTheme(themeName) {
        document.body.className = themeName;
        setStoredTheme(themeName);
        toggleMenu();
    }
    
    // Calculator switching
function showCalculator(calculatorType) {
    var calculators = document.querySelectorAll('.calculator-view');
    for (var i = 0; i < calculators.length; i++) {
        calculators[i].classList.remove('active');
    }

    var targetCalculator;
    switch(calculatorType) {
        case 'year-finder':
            targetCalculator = document.getElementById('yearFinderCalculator');
            currentCalculator = 'yearFinder';
            break;
        case 'calendar-converter':
            targetCalculator = document.getElementById('calendarConverterCalculator');
            currentCalculator = 'calendarConverter';
            break;
        case 'easter':
            targetCalculator = document.getElementById('easterCalculator');
            currentCalculator = 'easter';
            break;
        case 'moon-phase':
            targetCalculator = document.getElementById('moonPhaseCalculator');
            currentCalculator = 'moonPhase';
            break;
        case 'date-math':
            targetCalculator = document.getElementById('dateMathCalculator');
            currentCalculator = 'dateMath';
            break;
        default:
            targetCalculator = document.getElementById('dayOfWeekCalculator');
            currentCalculator = 'dayOfWeek';
    }
    if (targetCalculator) {
        targetCalculator.classList.add('active');
    }
    // Nové - vždy zavřít menu a podmenu
    var dropdown = document.getElementById('menuDropdown');
    if (dropdown) {
        dropdown.classList.remove('show');
        dropdown.style.display = 'none';
        isMenuOpen = false;
    }
}

function changeTheme(themeName) {
    document.body.className = themeName;
    setStoredTheme(themeName);
    // Nové - vždy zavřít menu a podmenu
    var dropdown = document.getElementById('menuDropdown');
    if (dropdown) {
        dropdown.classList.remove('show');
        dropdown.style.display = 'none';
        isMenuOpen = false;
    }
}
    
    // Display management
    function getCurrentDisplay() {
        switch(currentCalculator) {
            case 'yearFinder': return document.getElementById('yearFinderDisplay');
            case 'calendarConverter': return document.getElementById('converterDisplay');
            case 'easter': return document.getElementById('easterDisplay');
            case 'moonPhase': return document.getElementById('moonDisplay');
            case 'dateMath': return document.getElementById('dateMathDisplay');
            default: return document.getElementById('display');
        }
    }
    
    function showLoading() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display';
            display.innerHTML = '<div class="display-text"><span class="loading"></span>Počítám...</div>';
        }
    }
    
    function showResult(result) {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display result';
            display.innerHTML = '<div class="display-text">' + result + '</div>';
        }
    }
    
    function showError(error) {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display error';
            display.innerHTML = '<div class="display-text">⚠️ ' + error + '</div>';
        }
    }
    
    function clearDisplay() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display';
            var defaultText = currentCalculator === 'dayOfWeek' ? 
                'Zadejte datum pro výpočet' : 
                'Zadejte parametry pro výpočet';
            display.innerHTML = '<div class="display-text">' + defaultText + '</div>';
        }
    }
    
    function showVersion() {
        var display = getCurrentDisplay();
        if (display) {
            display.className = 'display result';
            display.innerHTML = '<div class="display-text">📅 <strong>Kalendářní kalkulátor v2.0</strong><br><small>Nové funkce: Hledač roků • Převod kalendářů<br>Velikonoce • Fáze Měsíce • Kalendářní aritmetika</small></div>';
        }
        toggleMenu();
    }
    
   

    function fillDate(dateString) {
        var dateInput = document.getElementById('dateInput');
        if (dateInput) {
            dateInput.value = dateString;
            clearDisplay();
        }
    }
    
    // Date parsing and validation functions
    function parseDate(dateString) {
        try {
            var cleaned = dateString.trim();
            var parts = cleaned.split(/[.\-\/\s]+/);
            
            if (parts.length === 1 && /^\d+$/.test(cleaned)) {
                var num = cleaned;
                if (num.length === 8) {
                    parts = [num.substring(0, 2), num.substring(2, 4), num.substring(4, 8)];
                } else if (num.length === 6) {
                    var year = parseInt(num.substring(4, 6));
                    var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                    parts = [num.substring(0, 2), num.substring(2, 4), fullYear.toString()];
                } else if (num.length === 7) {
                    if (parseInt(num.substring(1, 3)) <= 12) {
                        parts = [num.substring(0, 1), num.substring(1, 3), num.substring(3, 7)];
                    } else {
                        parts = [num.substring(0, 2), num.substring(2, 3), num.substring(3, 7)];
                    }
                } else if (num.length === 5) {
                    if (parseInt(num.substring(1, 3)) <= 12) {
                        var year = parseInt(num.substring(3, 5));
                        var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                        parts = [num.substring(0, 1), num.substring(1, 3), fullYear.toString()];
                    } else {
                        var year = parseInt(num.substring(3, 5));
                        var fullYear = year >= 50 ? 1900 + year : 2000 + year;
                        parts = [num.substring(0, 2), num.substring(2, 3), fullYear.toString()];
                    }
                } else if (num.length === 4) {
                    return { day: 1, month: 1, year: parseInt(num) };
                }
            }
            
            if (parts.length !== 3) return null;

            var day = parseInt(parts[0]);
            var month = parseInt(parts[1]);
            var year = parseInt(parts[2]);

            if (year < 100 && parts[2].length === 2 && (cleaned.indexOf('.') !== -1 || cleaned.indexOf('/') !== -1 || cleaned.indexOf('-') !== -1 || cleaned.indexOf(' ') !== -1)) {
                if (year >= 50) {
                    year += 1900;
                } else {
                    year += 2000;
                }
            }

            if (isNaN(day) || isNaN(month) || isNaN(year)) return null;
            return { day: day, month: month, year: year };
        } catch (e) {
            return null;
        }
    }
    
    function validateDate(day, month, year) {
        if (day < 1 || day > 31) return "Den musí být mezi 1 a 31";
        if (month < 1 || month > 12) return "Měsíc musí být mezi 1 a 12";
        if (year < 1) return "Rok musí být alespoň 1 (začátek našeho letopočtu)";

        var daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        if (day > daysInMonth[month - 1]) {
            return month + ". měsíc má pouze " + daysInMonth[month - 1] + " dní";
        }
        return null;
    }
    
    function isLeapYear(year) {
        if (year < 1582) {
            return year % 4 === 0;
        } else {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }
    }
    
    function openLink(url) {
        try {
            if (window.open) {
                window.open(url, '_blank');
            } else {
                window.location.href = url;
            }
        } catch (error) {
            try {
                window.location.href = url;
            } catch (e) {}
        }
        toggleMenu();
    }
    
<!-- part 4 -->    


// Day of week calculation (Zeller's congruence)
    function getDayOfWeek(d, m, r) {
        try {
            if (r === 1582 && m === 10 && d >= 5 && d <= 14) {
                return '<strong>' + d + '.' + m + '.' + r + '</strong> = Datum neexistuje!<br><small>Při přechodu z juliánského na gregoriánský kalendář byly tyto dny přeskočeny</small>';
            }

            var cal, h;

            if (r < 1582 || (r === 1582 && m < 10) || (r === 1582 && m === 10 && d <= 4)) {
                cal = "🗓 juliánský ";
                var me, rr;
                if (m < 3) {
                    me = m + 12;
                    rr = r - 1;
                } else {
                    me = m;
                    rr = r;
                }
                h = ((d + Math.floor((13 * (me + 1)) / 5) + rr + Math.floor(rr / 4) - 1) % 7 + 7) % 7;
                var daysJulian = ["Pátek", "Sobota", "Neděle", "Pondělí", "Úterý", "Středa", "Čtvrtek"];
                return '🗓️ <strong>' + d + '.' + m + '.' + r + '</strong> = <strong>' + daysJulian[h] + '</strong><br><small>' + cal + (isLeapYear(r) ? ' • přestupný' : '') + '</small>';
            } else {
                cal = "🗓 gregoriánský ";
                var me, rr;
                if (m < 3) {
                    me = m + 12;
                    rr = r - 1;
                } else {
                    me = m;
                    rr = r;
                }
                var k = rr % 100;
                var j = Math.floor(rr / 100);
                h = ((d + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
                var daysGregorian = ["Sobota", "Neděle", "Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek"];
                return '🗓️ <strong>' + d + '.' + m + '.' + r + '</strong> = <strong>' + daysGregorian[h] + '</strong><br><small>' + cal + (isLeapYear(r) ? ' • přestupný' : '') + '</small>';
            }
        } catch (e) {
            return "❌ Chyba ve výpočtu";
        }
    }
    
    function getDayOfWeekSimple(d, m, r) {
        var me = m, rr = r;
        if (m < 3) {
            me = m + 12;
            rr = r - 1;
        }
        
        if (r < 1582 || (r === 1582 && m < 10) || (r === 1582 && m === 10 && d <= 4)) {
            var h = ((d + Math.floor((13 * (me + 1)) / 5) + rr + Math.floor(rr / 4) - 1) % 7 + 7) % 7;
            var daysJulian = ["pátek", "sobota", "neděle", "pondělí", "úterý", "středa", "čtvrtek"];
            return daysJulian[h];
        } else {
            var k = rr % 100;
            var j = Math.floor(rr / 100);
            var h = ((d + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
            var daysGregorian = ["sobota", "neděle", "pondělí", "úterý", "středa", "čtvrtek", "pátek"];
            return daysGregorian[h];
        }
    }
    
    // Julian day number calculations
    function getJulianDayNumber(day, month, year, isJulian) {
        if (isJulian === undefined) isJulian = false;
        
        var a = Math.floor((14 - month) / 12);
        var y = year + 4800 - a;
        var m = month + 12 * a - 3;
        
        var jdn = day + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4);
        
        if (!isJulian) {
            jdn = jdn - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
        } else {
            jdn = jdn - 32083;
        }
        
        return jdn;
    }
    
    function getDateFromJulianDay(jdn, isJulian) {
        if (isJulian === undefined) isJulian = false;
        
        var a, b, c, d, e;
        
        if (!isJulian) {
            a = jdn + 32044;
            b = Math.floor((4 * a + 3) / 146097);
            c = a - Math.floor((146097 * b) / 4);
            d = Math.floor((4 * c + 3) / 1461);
            e = c - Math.floor((1461 * d) / 4);
        } else {
            a = jdn + 32082;
            d = Math.floor((4 * a + 3) / 1461);
            e = a - Math.floor((1461 * d) / 4);
        }
        
        var m = Math.floor((5 * e + 2) / 153);
        var day = e - Math.floor((153 * m + 2) / 5) + 1;
        var month = m + 3 - 12 * Math.floor(m / 10);
        var year = (!isJulian ? 100 * b : 0) + d - 4800 + Math.floor(m / 10);
        
        return { day: day, month: month, year: year };
    }
    
    // Date arithmetic
    function addDays(date, days) {
        var newDate = new Date(date.year, date.month - 1, date.day);
        newDate.setDate(newDate.getDate() + days);
        return {
            day: newDate.getDate(),
            month: newDate.getMonth() + 1,
            year: newDate.getFullYear()
        };
    }
    
    function formatDate(date) {
        return date.day + '.' + date.month + '.' + date.year;
    }
    
    // Easter calculation (algorithm from Gregorian calendar)
    function getEasterDate(year) {
        var a = year % 19;
        var b = Math.floor(year / 100);
        var c = year % 100;
        var d = Math.floor(b / 4);
        var e = b % 4;
        var f = Math.floor((b + 8) / 25);
        var g = Math.floor((b - f + 1) / 3);
        var h = (19 * a + b - d - g + 15) % 30;
        var i = Math.floor(c / 4);
        var k = c % 4;
        var l = (32 + 2 * e + 2 * i - h - k) % 7;
        var m = Math.floor((a + 11 * h + 22 * l) / 451);
        var month = Math.floor((h + l - 7 * m + 114) / 31);
        var day = ((h + l - 7 * m + 114) % 31) + 1;
        
        return { day: day, month: month, year: year };
    }
    
    // Moon phase calculations
    function getMoonAge(day, month, year) {
        var jd = getJulianDayNumber(day, month, year);
        var newMoonJD = 2451549.5; // JD nového měsíce 6.1.2000
        var synodicMonth = 29.53058867; // synodický měsíc ve dnech
        
        var daysSinceNewMoon = (jd - newMoonJD) % synodicMonth;
        if (daysSinceNewMoon < 0) daysSinceNewMoon += synodicMonth;
        
        return daysSinceNewMoon;
    }
    
    function getMoonPhase(age) {
        if (age < 1.84566) return "Nov";
        else if (age < 5.53699) return "Dorůstající srpek";
        else if (age < 9.22831) return "První čtvrť";
        else if (age < 12.91963) return "Dorůstající měsíc";
        else if (age < 16.61096) return "Úplněk";
        else if (age < 20.30228) return "Ubývající měsíc";
        else if (age < 23.99361) return "Poslední čtvrť";
        else if (age < 27.68493) return "Ubývající srpek";
        else return "Nov";
    }
    
    function getMoonEmoji(age) {
        if (age < 1.84566) return "🌑";
        else if (age < 5.53699) return "🌒";
        else if (age < 9.22831) return "🌓";
        else if (age < 12.91963) return "🌔";
        else if (age < 16.61096) return "🌕";
        else if (age < 20.30228) return "🌖";
        else if (age < 23.99361) return "🌗";
        else if (age < 27.68493) return "🌘";
        else return "🌑";
    }
    
    // Math type operation toggle
    function toggleMathOperation() {
        var mathType = document.getElementById('mathType').value;
        var addOp = document.getElementById('addOperation');
        var diffOp = document.getElementById('diffOperation');
        
        if (mathType === 'add') {
            addOp.style.display = 'block';
            diffOp.style.display = 'none';
        } else {
            addOp.style.display = 'none';
            diffOp.style.display = 'block';
        }
        clearDisplay();
    }
    
<!-- part 5 -->    

// Main calculator functions
    function calculateDayOfWeek() {
        try {
            var dateInput = document.getElementById('dateInput');
            if (!dateInput) return;

            var dateString = dateInput.value.trim();
            if (!dateString) {
                showError("Zadejte datum v libovolném formátu");
                return;
            }

            var parsed = parseDate(dateString);
            if (!parsed) {
                showError("Neplatný formát data. Zkuste: 1.1.1, 15.3.44, 1/3/89, 01031989");
                return;
            }

            var error = validateDate(parsed.day, parsed.month, parsed.year);
            if (error) {
                showError(error);
                return;
            }

            showLoading();
            setTimeout(function() {
                var result = getDayOfWeek(parsed.day, parsed.month, parsed.year);
                showResult(result);
            }, 300);
        } catch (e) {
            showError("Došlo k chybě při výpočtu");
        }
    }
    
    function calculateYearFinder() {
        var day = parseInt(document.getElementById('yearFinderDay').value);
        var month = parseInt(document.getElementById('yearFinderMonth').value);
        var dayOfWeek = parseInt(document.getElementById('yearFinderDayOfWeek').value);
        
        if (!day || !month || isNaN(dayOfWeek)) {
            showError("Vyplňte všechna pole");
            return;
        }
        
        if (day < 1 || day > 31 || month < 1 || month > 12) {
            showError("Neplatný den nebo měsíc");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var years = [];
            var dayNames = ["neděle", "pondělí", "úterý", "středa", "čtvrtek", "pátek", "sobota"];
            
            for (var year = 2000; year <= 2100; year++) {
                var daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                if (day <= daysInMonth[month - 1]) {
                    var me = month, rr = year;
                    if (month < 3) {
                        me = month + 12;
                        rr = year - 1;
                    }
                    var k = rr % 100;
                    var j = Math.floor(rr / 100);
                    var h = ((day + Math.floor((13 * (me + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - (2 * j)) % 7 + 7) % 7;
                            // Převod: v aplikaci je 0=Neděle ... 6=Sobota, Zeller vrací 0=Saturday
        var calculatedDayOfWeek = (h + 6) % 7;
                    
                    if (calculatedDayOfWeek === dayOfWeek) {
                        years.push(year + (isLeapYear(year) ? ' <strong>(přestupný)</strong>' : ''));
                    }
                }
            }
            
            if (years.length > 0) {
                showResult('<strong>' + day + '.' + month + '. připadá na ' + dayNames[dayOfWeek] + ' v letech:</strong><br><small>' + years.join(', ') + '</small>');
            } else {
                showResult('Pro zadané parametry nebyli nalezeni žádné roky v období 2000-2100');
            }
        }, 300);
    }
    
    function calculateConverter() {
        var dateStr = document.getElementById('converterDate').value.trim();
        var type = document.getElementById('converterType').value;
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatný formát data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var result = '';
if (type === 'gregorian') {
    var julianDay = getJulianDayNumber(parsed.day, parsed.month, parsed.year);
    var julianDate = getDateFromJulianDay(julianDay, true); // true pro juliánský kalendář

    var julianJDN = getJulianDayNumber(parsed.day, parsed.month, parsed.year, true);
    var rozdil = julianDay - julianJDN;

    result = '<strong>Gregoriánský:</strong> ' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
            '<br><strong>Juliánský:</strong> ' + julianDate.day + '.' + julianDate.month + '.' + julianDate.year +
            '<br><small>Rozdíl: ' + rozdil + ' dní</small>';
} else {
    var julianDay = getJulianDayNumber(parsed.day, parsed.month, parsed.year, true);
    var gregorianDate = getDateFromJulianDay(julianDay, false); // false pro gregoriánský kalendář
    var gregJDN = getJulianDayNumber(parsed.day, parsed.month, parsed.year);
    var rozdil = gregJDN - julianDay;

    result = '<strong>Juliánský:</strong> ' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
            '<br><strong>Gregoriánský:</strong> ' + gregorianDate.day + '.' + gregorianDate.month + '.' + gregorianDate.year +
            '<br><small>Rozdíl: ' + rozdil + ' dní</small>';
}
            showResult(result);
        }, 300);
    }
    
    function calculateEaster() {
        var year = parseInt(document.getElementById('easterYear').value);
        
        if (!year || year < 1 || year > 9999) {
            showError("Zadejte platný rok (1-9999)");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var easter = getEasterDate(year);
            var ashWednesday = addDays(easter, -46);
            var palmSunday = addDays(easter, -7);
            var goodFriday = addDays(easter, -2);
            var easterMonday = addDays(easter, 1);
            var whiteSunday = addDays(easter, 7);
            
            var result = '<strong>Velikonoční svátky ' + year + ':</strong><br>' +
                        '<small>Popeleční středa: ' + formatDate(ashWednesday) + '<br>' +
                        'Květná neděle: ' + formatDate(palmSunday) + '<br>' +
                        'Velký pátek: ' + formatDate(goodFriday) + '<br>' +
                        '<strong>Velikonoční neděle: ' + formatDate(easter) + '</strong><br>' +
                        'Velikonoční pondělí: ' + formatDate(easterMonday) + '<br>' +
                        'Bílá neděle: ' + formatDate(whiteSunday) + '</small>';
            
            showResult(result);
        }, 300);
    }
    
    function calculateMoonPhase() {
        var dateStr = document.getElementById('moonDate').value.trim();
        
        if (!dateStr) {
            showError("Zadejte datum");
            return;
        }
        
        var parsed = parseDate(dateStr);
        if (!parsed) {
            showError("Neplatný formát data");
            return;
        }
        
        showLoading();
        setTimeout(function() {
            var moonAge = getMoonAge(parsed.day, parsed.month, parsed.year);
            var phase = getMoonPhase(moonAge);
            var emoji = getMoonEmoji(moonAge);
            
            var result = '<strong>' + parsed.day + '.' + parsed.month + '.' + parsed.year + '</strong><br>' +
                        emoji + ' <strong>' + phase + '</strong><br>' +
                        '<small>Stáří Měsíce: ' + moonAge.toFixed(1) + ' dní</small>';
            
            showResult(result);
        }, 300);
    }
    
    function calculateDateMath() {
        var mathType = document.getElementById('mathType').value;
        
        if (mathType === 'add') {
            var dateStr = document.getElementById('mathDate1').value.trim();
            var days = parseInt(document.getElementById('mathDays').value);
            
            if (!dateStr || isNaN(days)) {
                showError("Zadejte datum a počet dní");
                return;
            }
            
            var parsed = parseDate(dateStr);
            if (!parsed) {
                showError("Neplatný formát data");
                return;
            }
            
            showLoading();
            setTimeout(function() {
                var resultDate = addDays(parsed, days);
                var dayOfWeek = getDayOfWeekSimple(resultDate.day, resultDate.month, resultDate.year);
                
                var operation = days >= 0 ? 'přičtení' : 'odečtení';
                var result = '<strong>' + parsed.day + '.' + parsed.month + '.' + parsed.year + 
                           ' ' + (days >= 0 ? '+' : '') + days + ' dní:</strong><br>' +
                           '<strong>' + resultDate.day + '.' + resultDate.month + '.' + resultDate.year + '</strong><br>' +
                           '<small>' + dayOfWeek + '</small>';
                
                showResult(result);
            }, 300);
        } else {
            var dateStr1 = document.getElementById('mathDate2').value.trim();
            var dateStr2 = document.getElementById('mathDate3').value.trim();
            
            if (!dateStr1 || !dateStr2) {
                showError("Zadejte obě data");
                return;
            }
            
            var parsed1 = parseDate(dateStr1);
            var parsed2 = parseDate(dateStr2);
            
            if (!parsed1 || !parsed2) {
                showError("Neplatný formát data");
                return;
            }
            
            showLoading();
            setTimeout(function() {
                var jd1 = getJulianDayNumber(parsed1.day, parsed1.month, parsed1.year);
                var jd2 = getJulianDayNumber(parsed2.day, parsed2.month, parsed2.year);
                var diff = Math.abs(jd2 - jd1);
                
                var years = Math.floor(diff / 365.25);
                var weeks = Math.floor(diff / 7);
                var remainingDays = diff % 7;
                
                var result = '<strong>Rozdíl mezi daty:</strong><br>' +
                           parsed1.day + '.' + parsed1.month + '.' + parsed1.year + ' a ' +
                           parsed2.day + '.' + parsed2.month + '.' + parsed2.year + '<br>' +
                           '<strong>' + diff + ' dní</strong><br>' +
                           '<small>' + weeks + ' týdnů a ' + remainingDays + ' dní<br>' +
                           'Přibližně ' + years + ' let</small>';
                
                showResult(result);
            }, 300);
        }
    }


<!-- part 6 -->


// Application initialization
    function initializeApp() {
        try {
            var savedTheme = getStoredTheme();
            if (savedTheme) {
                document.body.className = savedTheme;
            }
            
            // Menu button
            var menuButton = document.getElementById('menuButton');
            if (menuButton) {
                menuButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMenu();
                });
                menuButton.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMenu();
                });
            }
            
            // Main menu items
            var dayOfWeekMenu = document.getElementById('dayOfWeekMenu');
            if (dayOfWeekMenu) {
                dayOfWeekMenu.addEventListener('click', function() {
                    showCalculator('dayOfWeek');
                });
                dayOfWeekMenu.addEventListener('touchend', function() {
                    showCalculator('dayOfWeek');
                });
            }
            
 var calculatorsMenu = document.getElementById('calculatorsMenu');
if (calculatorsMenu) {
    let touchMoved = false;
    calculatorsMenu.addEventListener('touchstart', function(e) {
        touchMoved = false;
    });
    calculatorsMenu.addEventListener('touchmove', function(e) {
        touchMoved = true;
    });
    calculatorsMenu.addEventListener('touchend', function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (!touchMoved) toggleSubmenu('calculatorsSubmenu');
    });
    calculatorsMenu.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleSubmenu('calculatorsSubmenu');
    });
}
            
            // Calculator menu items
           var calcItems = document.querySelectorAll('[data-calculator]');
for (var i = 0; i < calcItems.length; i++) {
    (function(item) {
        var calc = item.getAttribute('data-calculator');
        let touchMoved = false;
        item.addEventListener('touchstart', function(e) {
            touchMoved = false;
        });
        item.addEventListener('touchmove', function(e) {
            touchMoved = true;
        });
        item.addEventListener('touchend', function(e) {
            if (!touchMoved) showCalculator(calc);
        });
        item.addEventListener('click', function() {
            showCalculator(calc);
        });
    })(calcItems[i]);
}
            
            // Back buttons
            var backButtons = document.querySelectorAll('[data-back]');
            for (var i = 0; i < backButtons.length; i++) {
                (function(button) {
                    button.addEventListener('click', function() {
                        showCalculator('dayOfWeek');
                    });
                    button.addEventListener('touchend', function() {
                        showCalculator('dayOfWeek');
                    });
                })(backButtons[i]);
            }
            
            // Version button
            var versionButton = document.getElementById('versionButton');
            if (versionButton) {
                versionButton.addEventListener('click', showVersion);
                versionButton.addEventListener('touchend', showVersion);
            }
            
            // Theme items
            var themeItems = document.querySelectorAll('.theme-item');
            for (var i = 0; i < themeItems.length; i++) {
                (function(item) {
                    var theme = item.getAttribute('data-theme') || '';
                    let touchMoved = false;

item.addEventListener('touchstart', function(e) {
    touchMoved = false;
});
item.addEventListener('touchmove', function(e) {
    touchMoved = true;
});
item.addEventListener('touchend', function(e) {
    if (!touchMoved) {
        changeTheme(theme);
    }
});
item.addEventListener('click', function() {
    changeTheme(theme);
});
                })(themeItems[i]);
            }
            
            // Link items
            var linkItems = document.querySelectorAll('[data-link]');
            for (var i = 0; i < linkItems.length; i++) {
                (function(item) {
                    var link = item.getAttribute('data-link');
                    item.addEventListener('click', function() {
                        openLink(link);
                    });
                    item.addEventListener('touchend', function() {
                        openLink(link);
                    });
                })(linkItems[i]);
            }
            
     
            
            // Input focus tracking
            var inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
            for (var i = 0; i < inputs.length; i++) {
                (function(input) {
                    input.addEventListener('focus', function() {
                        activeInput = input;
                    });
                    input.addEventListener('input', clearDisplay);
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter' || e.keyCode === 13) {
                            e.preventDefault();
                            switch(currentCalculator) {
                                case 'dayOfWeek':
                                    calculateDayOfWeek();
                                    break;
                                case 'yearFinder':
                                    calculateYearFinder();
                                    break;
                                case 'calendarConverter':
                                    calculateConverter();
                                    break;
                                case 'easter':
                                    calculateEaster();
                                    break;
                                case 'moonPhase':
                                    calculateMoonPhase();
                                    break;
                                case 'dateMath':
                                    calculateDateMath();
                                    break;
                            }
                        }
                    });
                })(inputs[i]);
            }
            
            // Calculate buttons
            var calculateBtn = document.getElementById('calculateBtn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateDayOfWeek);
                calculateBtn.addEventListener('touchend', calculateDayOfWeek);
            }
            
            var yearFinderBtn = document.getElementById('yearFinderBtn');
            if (yearFinderBtn) {
                yearFinderBtn.addEventListener('click', calculateYearFinder);
                yearFinderBtn.addEventListener('touchend', calculateYearFinder);
            }
            
            var converterBtn = document.getElementById('converterBtn');
            if (converterBtn) {
                converterBtn.addEventListener('click', calculateConverter);
                converterBtn.addEventListener('touchend', calculateConverter);
            }
            
            var easterBtn = document.getElementById('easterBtn');
            if (easterBtn) {
                easterBtn.addEventListener('click', calculateEaster);
                easterBtn.addEventListener('touchend', calculateEaster);
            }
            
            var moonBtn = document.getElementById('moonBtn');
            if (moonBtn) {
                moonBtn.addEventListener('click', calculateMoonPhase);
                moonBtn.addEventListener('touchend', calculateMoonPhase);
            }
            
            var dateMathBtn = document.getElementById('dateMathBtn');
            if (dateMathBtn) {
                dateMathBtn.addEventListener('click', calculateDateMath);
                dateMathBtn.addEventListener('touchend', calculateDateMath);
            }
            
            // Math type selector
            var mathType = document.getElementById('mathType');
            if (mathType) {
                mathType.addEventListener('change', toggleMathOperation);
            }
            
            // Example items for day of week calculator
var exampleItems = document.querySelectorAll('[data-date]');
for (var i = 0; i < exampleItems.length; i++) {
    (function(item) {
        var date = item.getAttribute('data-date');
        let touchMoved = false;
        item.addEventListener('touchstart', function(e) {
            touchMoved = false;
        });
        item.addEventListener('touchmove', function(e) {
            touchMoved = true;
        });
        item.addEventListener('touchend', function(e) {
            if (!touchMoved) fillDate(date);
        });
        item.addEventListener('click', function() {
            fillDate(date);
        });
    })(exampleItems[i]);
}
            
            // Close menu when clicking outside
            function closeMenuOutside(event) {
                var menuContainer = document.querySelector('.menu-container');
                var dropdown = document.getElementById('menuDropdown');
                
                if (menuContainer && dropdown && !menuContainer.contains(event.target) && isMenuOpen) {
                    dropdown.classList.remove('show');
                    isMenuOpen = false;
                }
            }
            
            document.addEventListener('click', closeMenuOutside);
            document.addEventListener('touchstart', closeMenuOutside);
            
            // Prevent double tap zoom
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Handle orientation change
            function handleOrientationChange() {
                setTimeout(function() {
                    var dropdown = document.getElementById('menuDropdown');
                    if (dropdown && isMenuOpen) {
                        dropdown.classList.remove('show');
                        setTimeout(function() {
                            dropdown.classList.add('show');
                        }, 50);
                    }
                }, 100);
            }
            
            if (window.addEventListener) {
                window.addEventListener('orientationchange', handleOrientationChange);
                window.addEventListener('resize', handleOrientationChange);
            }
            
        } catch (error) {
            console.log('Initialization error:', error);
        }
    }
    
    // Initialize app when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
        initializeApp();
    }
    
})();
</script>
</body>
</html>


